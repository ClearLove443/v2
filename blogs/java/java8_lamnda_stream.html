<!DOCTYPE html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.59" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://clearlove443.github.io.v2/v2/blogs/java/java8_lamnda_stream.html"><meta property="og:site_name" content="clearlove's blog"><meta property="og:title" content="Java8ä¹‹Lambdaä»¥åŠStream/Map"><meta property="og:description" content="Java Lambda è¡¨è¾¾å¼çš„ä¸€ä¸ªé‡è¦ç”¨æ³•æ˜¯ç®€åŒ–æŸäº›åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous Classesï¼‰çš„å†™æ³•ã€‚å®é™…ä¸Š Lambda è¡¨è¾¾å¼å¹¶ä¸ä»…ä»…æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼ŒJVM å†…éƒ¨æ˜¯é€šè¿‡ invokedynamic æŒ‡ä»¤æ¥å®ç° Lambda è¡¨è¾¾å¼çš„ã€‚å…·ä½“åŸç†æ”¾åˆ°ä¸‹ä¸€ç¯‡ã€‚æœ¬ç¯‡æˆ‘ä»¬é¦–å…ˆæ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¸¦æ¥çš„ä¾¿åˆ©ä¹‹å¤„ã€‚ Lambda an..."><meta property="og:type" content="article"><meta property="og:updated_time" content="2023-05-21T04:38:09.000Z"><meta property="og:locale" content="en-US"><meta property="article:tag" content="stream"><meta property="article:tag" content="lambda"><meta property="article:published_time" content="2022-02-20T19:50:59.000Z"><meta property="article:modified_time" content="2023-05-21T04:38:09.000Z"><title>Java8ä¹‹Lambdaä»¥åŠStream/Map | clearlove's blog</title><meta name="description" content="Java Lambda è¡¨è¾¾å¼çš„ä¸€ä¸ªé‡è¦ç”¨æ³•æ˜¯ç®€åŒ–æŸäº›åŒ¿åå†…éƒ¨ç±»ï¼ˆAnonymous Classesï¼‰çš„å†™æ³•ã€‚å®é™…ä¸Š Lambda è¡¨è¾¾å¼å¹¶ä¸ä»…ä»…æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼ŒJVM å†…éƒ¨æ˜¯é€šè¿‡ invokedynamic æŒ‡ä»¤æ¥å®ç° Lambda è¡¨è¾¾å¼çš„ã€‚å…·ä½“åŸç†æ”¾åˆ°ä¸‹ä¸€ç¯‡ã€‚æœ¬ç¯‡æˆ‘ä»¬é¦–å…ˆæ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¸¦æ¥çš„ä¾¿åˆ©ä¹‹å¤„ã€‚ Lambda an...">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/v2/assets/style-79d8db3c.css" as="style"><link rel="stylesheet" href="/v2/assets/style-79d8db3c.css">
    <link rel="modulepreload" href="/v2/assets/app-8407fbc1.js"><link rel="modulepreload" href="/v2/assets/framework-bdfa852d.js"><link rel="modulepreload" href="/v2/assets/java8_lamnda_stream.html-bd11ad48.js"><link rel="modulepreload" href="/v2/assets/java8_lamnda_stream.html-2622d226.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container no-sidebar has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/v2/" class="brand"><img class="logo" src="/v2/profile.png" alt="clearlove&#39;s blog"><!----><span class="site-name hide-in-pad">clearlove&#39;s blog</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/v2/" class="nav-link" aria-label="Home"><span class="icon iconfont icon-home"></span>Home<!----></a></div><div class="nav-item hide-in-mobile"><a href="/v2/zh/demo/" class="nav-link" aria-label="Demo"><span class="icon iconfont icon-discover"></span>Demo<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://vuepress-theme-hope.github.io/v2/zh/" rel="noopener noreferrer" target="_blank" aria-label="V2 Docs" class="nav-link"><span class="icon iconfont icon-note"></span>V2 Docs<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!--[--><!----><!--]--></div><div class="navbar-right"><!--[--><!----><!--]--><!----><!----><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><div class="search-pro-button" role="search" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></div><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Java8ä¹‹Lambdaä»¥åŠStream/Map</h1><div class="page-info"><span class="author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="author-item">Clear Love</span></span><span property="author" content="Clear Love"></span></span><!----><span class="date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2022-02-20T19:50:59.000Z"></span><span class="category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><span class="category-item category3 clickable" role="navigation">back-end-java</span><meta property="articleSection" content="back-end-java"></span><span class="tag-info" aria-label="TagğŸ·" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><span class="tag-item tag-item7 clickable" role="navigation">stream</span><span class="tag-item tag-item3 clickable" role="navigation">lambda</span><meta property="keywords" content="stream,lambda"></span><span class="reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 53 min</span><meta property="timeRequired" content="PT53M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">On This Page</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#lambda-and-anonymous-classes-i" class="router-link-active router-link-exact-active toc-link level2">Lambda and Anonymous Classes(I)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ç®€å†™çš„ä¾æ®" class="router-link-active router-link-exact-active toc-link level3">ç®€å†™çš„ä¾æ®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#è‡ªå®šä¹‰å‡½æ•°æ¥å£" class="router-link-active router-link-exact-active toc-link level3">è‡ªå®šä¹‰å‡½æ•°æ¥å£</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#æ–¹æ³•å¼•ç”¨" class="router-link-active router-link-exact-active toc-link level3">æ–¹æ³•å¼•ç”¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#lambda-and-anonymous-classes-ii" class="router-link-active router-link-exact-active toc-link level2">Lambda and Anonymous Classes(II)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#åŒ¿åå†…éƒ¨ç±»å®ç°" class="router-link-active router-link-exact-active toc-link level3">åŒ¿åå†…éƒ¨ç±»å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#lambda-è¡¨è¾¾å¼å®ç°" class="router-link-active router-link-exact-active toc-link level3">Lambda è¡¨è¾¾å¼å®ç°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#æ¨è®º-this-å¼•ç”¨çš„æ„ä¹‰" class="router-link-active router-link-exact-active toc-link level3">æ¨è®ºï¼Œthis å¼•ç”¨çš„æ„ä¹‰</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#lambda-and-collections" class="router-link-active router-link-exact-active toc-link level2">Lambda and Collections</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#collection-ä¸­çš„æ–°æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">Collection ä¸­çš„æ–°æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#map-ä¸­çš„æ–°æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">Map ä¸­çš„æ–°æ–¹æ³•</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#streams-api-i" class="router-link-active router-link-exact-active toc-link level2">Streams API(I)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#stream-æ–¹æ³•ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level3">stream æ–¹æ³•ä½¿ç”¨</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#streams-api-ii" class="router-link-active router-link-exact-active toc-link level2">Streams API(II)</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#å¤šé¢æ‰‹-reduce" class="router-link-active router-link-exact-active toc-link level3">å¤šé¢æ‰‹ reduce()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ç»ˆææ­¦å™¨-collect" class="router-link-active router-link-exact-active toc-link level3">ç»ˆææ­¦å™¨ collect()</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#æ¥å£çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•" class="router-link-active router-link-exact-active toc-link level3">æ¥å£çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#æ–¹æ³•å¼•ç”¨-1" class="router-link-active router-link-exact-active toc-link level3">æ–¹æ³•å¼•ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#æ”¶é›†å™¨" class="router-link-active router-link-exact-active toc-link level3">æ”¶é›†å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ä½¿ç”¨-collect-ç”Ÿæˆ-collection" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨ collect()ç”Ÿæˆ Collection</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ä½¿ç”¨-collect-ç”Ÿæˆ-map" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨ collect()ç”Ÿæˆ Map</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ä½¿ç”¨-collect-åšå­—ç¬¦ä¸²-join" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨ collect()åšå­—ç¬¦ä¸² join</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#collect-è¿˜å¯ä»¥åšæ›´å¤š" class="router-link-active router-link-exact-active toc-link level3">collect()è¿˜å¯ä»¥åšæ›´å¤š</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#stream-pipelines" class="router-link-active router-link-exact-active toc-link level2">Stream Pipelines</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ä¸€ç§ç›´ç™½çš„å®ç°æ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">ä¸€ç§ç›´ç™½çš„å®ç°æ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#stream-æµæ°´çº¿è§£å†³æ–¹æ¡ˆ" class="router-link-active router-link-exact-active toc-link level3">Stream æµæ°´çº¿è§£å†³æ–¹æ¡ˆ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#ç»“è¯­" class="router-link-active router-link-exact-active toc-link level2">ç»“è¯­</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/v2/blogs/java/java8_lamnda_stream.html#å‚è€ƒé“¾æ¥" class="router-link-active router-link-exact-active toc-link level2">å‚è€ƒé“¾æ¥</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>Java Lambda è¡¨è¾¾å¼çš„ä¸€ä¸ªé‡è¦ç”¨æ³•æ˜¯ç®€åŒ–æŸäº›åŒ¿åå†…éƒ¨ç±»<code>ï¼ˆAnonymous Classesï¼‰</code>çš„å†™æ³•ã€‚å®é™…ä¸Š Lambda è¡¨è¾¾å¼å¹¶ä¸ä»…ä»…æ˜¯åŒ¿åå†…éƒ¨ç±»çš„è¯­æ³•ç³–ï¼ŒJVM å†…éƒ¨æ˜¯é€šè¿‡ invokedynamic æŒ‡ä»¤æ¥å®ç° Lambda è¡¨è¾¾å¼çš„ã€‚å…·ä½“åŸç†æ”¾åˆ°ä¸‹ä¸€ç¯‡ã€‚æœ¬ç¯‡æˆ‘ä»¬é¦–å…ˆæ„Ÿå—ä¸€ä¸‹ä½¿ç”¨ Lambda è¡¨è¾¾å¼å¸¦æ¥çš„ä¾¿åˆ©ä¹‹å¤„ã€‚</p><h2 id="lambda-and-anonymous-classes-i" tabindex="-1"><a class="header-anchor" href="#lambda-and-anonymous-classes-i" aria-hidden="true">#</a> Lambda and Anonymous Classes(I)</h2><p>æœ¬èŠ‚å°†ä»‹ç»å¦‚ä½•ä½¿ç”¨ Lambda è¡¨è¾¾å¼ç®€åŒ–åŒ¿åå†…éƒ¨ç±»çš„ä¹¦å†™ï¼Œä½† Lambda è¡¨è¾¾å¼å¹¶ä¸èƒ½å–ä»£æ‰€æœ‰çš„åŒ¿åå†…éƒ¨ç±»ï¼Œåªèƒ½ç”¨æ¥å–ä»£å‡½æ•°æ¥å£ï¼ˆFunctional Interfaceï¼‰çš„ç®€å†™ã€‚å…ˆåˆ«åœ¨ä¹ç»†èŠ‚ï¼Œçœ‹å‡ ä¸ªä¾‹å­å†è¯´ã€‚</p><ol><li>ä¾‹å­ 1ï¼šæ— å‚å‡½æ•°çš„ç®€å†™</li></ol><p>å¦‚æœéœ€è¦æ–°å»ºä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ç§å¸¸è§çš„å†™æ³•æ˜¯è¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// JDK7 åŒ¿åå†…éƒ¨ç±»å†™æ³•</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ¥å£å</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ–¹æ³•å</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread run()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç»™ Tread ç±»ä¼ é€’äº†ä¸€ä¸ªåŒ¿åçš„ Runnable å¯¹è±¡ï¼Œé‡è½½ Runnable æ¥å£çš„ run()æ–¹æ³•æ¥å®ç°ç›¸åº”é€»è¾‘ã€‚è¿™æ˜¯ JDK7 ä»¥åŠä¹‹å‰çš„å¸¸è§å†™æ³•ã€‚åŒ¿åå†…éƒ¨ç±»çœå»äº†ä¸ºç±»èµ·åå­—çš„çƒ¦æ¼ï¼Œä½†è¿˜æ˜¯ä¸å¤Ÿç®€åŒ–ï¼Œåœ¨ Java 8 ä¸­å¯ä»¥ç®€åŒ–ä¸ºå¦‚ä¸‹å½¢å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// JDK8 Lambdaè¡¨è¾¾å¼å†™æ³•</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Thread run()&quot;</span><span class="token punctuation">)</span><span class="token comment">// çœç•¥æ¥å£åå’Œæ–¹æ³•å</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è·ŸåŒ¿åå†…éƒ¨ç±»çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ï¼Œä½†æ¯”åŒ¿åå†…éƒ¨ç±»æ›´è¿›ä¸€æ­¥ã€‚è¿™é‡Œè¿æ¥å£åå’Œå‡½æ•°åéƒ½ä¸€åŒçœæ‰äº†ï¼Œå†™èµ·æ¥æ›´åŠ ç¥æ¸…æ°”çˆ½ã€‚å¦‚æœå‡½æ•°ä½“æœ‰å¤šè¡Œï¼Œå¯ä»¥ç”¨å¤§æ‹¬å·æ‹¬èµ·æ¥ï¼Œå°±åƒè¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// JDK8 Lambdaè¡¨è¾¾å¼ä»£ç å—å†™æ³•</span>
<span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; Hoolee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ä¾‹å­ 2ï¼šå¸¦å‚å‡½æ•°çš„ç®€å†™</li></ol><p>å¦‚æœè¦ç»™ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨é€šè¿‡è‡ªå®šä¹‰æ¯”è¾ƒå™¨ï¼ŒæŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦è¿›è¡Œæ’åºï¼ŒJava 7 çš„ä¹¦å†™å½¢å¼å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// JDK7 åŒ¿åå†…éƒ¨ç±»å†™æ³•</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ¥å£å</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> s1<span class="token punctuation">,</span> <span class="token class-name">String</span> s2<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// æ–¹æ³•å</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>s2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç é€šè¿‡å†…éƒ¨ç±»é‡è½½äº† Comparator æ¥å£çš„ compare()æ–¹æ³•ï¼Œå®ç°æ¯”è¾ƒé€»è¾‘ã€‚é‡‡ç”¨ Lambda è¡¨è¾¾å¼å¯ç®€å†™å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// JDK8 Lambdaè¡¨è¾¾å¼å†™æ³•</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span><span class="token punctuation">{</span><span class="token comment">// çœç•¥å‚æ•°è¡¨çš„ç±»å‹</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>s1 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>s2 <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>s2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è·ŸåŒ¿åå†…éƒ¨ç±»çš„ä½œç”¨æ˜¯ä¸€æ ·çš„ã€‚é™¤äº†çœç•¥äº†æ¥å£åå’Œæ–¹æ³•åï¼Œä»£ç ä¸­æŠŠå‚æ•°è¡¨çš„ç±»å‹ä¹Ÿçœç•¥äº†ã€‚è¿™å¾—ç›Šäº javac çš„ç±»å‹æ¨æ–­æœºåˆ¶ï¼Œç¼–è¯‘å™¨èƒ½å¤Ÿæ ¹æ®ä¸Šä¸‹æ–‡ä¿¡æ¯æ¨æ–­å‡ºå‚æ•°çš„ç±»å‹ï¼Œå½“ç„¶ä¹Ÿæœ‰æ¨æ–­å¤±è´¥çš„æ—¶å€™ï¼Œè¿™æ—¶å°±éœ€è¦æ‰‹åŠ¨æŒ‡æ˜å‚æ•°ç±»å‹äº†ã€‚æ³¨æ„ï¼ŒJava æ˜¯å¼ºç±»å‹è¯­è¨€ï¼Œæ¯ä¸ªå˜é‡å’Œå¯¹è±¡éƒ½å¿…éœ€æœ‰æ˜ç¡®çš„ç±»å‹ã€‚</p><h3 id="ç®€å†™çš„ä¾æ®" tabindex="-1"><a class="header-anchor" href="#ç®€å†™çš„ä¾æ®" aria-hidden="true">#</a> ç®€å†™çš„ä¾æ®</h3><p>ä¹Ÿè®¸ä½ å·²ç»æƒ³åˆ°äº†ï¼Œèƒ½å¤Ÿä½¿ç”¨ Lambda çš„ä¾æ®æ˜¯å¿…é¡»æœ‰ç›¸åº”çš„å‡½æ•°æ¥å£ï¼ˆå‡½æ•°æ¥å£ï¼Œæ˜¯æŒ‡å†…éƒ¨åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ï¼‰ã€‚è¿™ä¸€ç‚¹è·Ÿ Java æ˜¯å¼ºç±»å‹è¯­è¨€å»åˆï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¹¶ä¸èƒ½åœ¨ä»£ç çš„ä»»ä½•åœ°æ–¹ä»»æ€§çš„å†™ Lambda è¡¨è¾¾å¼ã€‚å®é™…ä¸Š Lambda çš„ç±»å‹å°±æ˜¯å¯¹åº”å‡½æ•°æ¥å£çš„ç±»å‹ã€‚Lambda è¡¨è¾¾å¼å¦ä¸€ä¸ªä¾æ®æ˜¯ç±»å‹æ¨æ–­æœºåˆ¶ï¼Œåœ¨ä¸Šä¸‹æ–‡ä¿¡æ¯è¶³å¤Ÿçš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨å¯ä»¥æ¨æ–­å‡ºå‚æ•°è¡¨çš„ç±»å‹ï¼Œè€Œä¸éœ€è¦æ˜¾å¼æŒ‡åã€‚Lambda è¡¨è¾¾æ›´å¤šåˆæ³•çš„ä¹¦å†™å½¢å¼å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Lambdaè¡¨è¾¾å¼çš„ä¹¦å†™å½¢å¼</span>
<span class="token class-name">Runnable</span> run <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Hello World&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1</span>
<span class="token class-name">ActionListener</span> listener <span class="token operator">=</span> event <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;button clicked&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2</span>
<span class="token class-name">Runnable</span> multiLine <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span><span class="token comment">// 3 ä»£ç å—</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot; Hoolee&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> add <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span> x<span class="token punctuation">,</span> <span class="token class-name">Long</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token comment">// 4</span>
<span class="token class-name">BinaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> addImplicit <span class="token operator">=</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span><span class="token comment">// 5 ç±»å‹æ¨æ–­</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œ1 å±•ç¤ºäº†æ— å‚å‡½æ•°çš„ç®€å†™ï¼›2 å¤„å±•ç¤ºäº†æœ‰å‚å‡½æ•°çš„ç®€å†™ï¼Œä»¥åŠç±»å‹æ¨æ–­æœºåˆ¶ï¼›3 æ˜¯ä»£ç å—çš„å†™æ³•ï¼›4 å’Œ 5 å†æ¬¡å±•ç¤ºäº†ç±»å‹æ¨æ–­æœºåˆ¶ã€‚</p><h3 id="è‡ªå®šä¹‰å‡½æ•°æ¥å£" tabindex="-1"><a class="header-anchor" href="#è‡ªå®šä¹‰å‡½æ•°æ¥å£" aria-hidden="true">#</a> è‡ªå®šä¹‰å‡½æ•°æ¥å£</h3><p>è‡ªå®šä¹‰å‡½æ•°æ¥å£å¾ˆå®¹æ˜“ï¼Œåªéœ€è¦ç¼–å†™ä¸€ä¸ªåªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£å³å¯ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// è‡ªå®šä¹‰å‡½æ•°æ¥å£</span>
<span class="token annotation punctuation">@FunctionalInterface</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ConsumerInterface</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
  <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç ä¸­çš„@FunctionalInterface æ˜¯å¯é€‰çš„ï¼Œä½†åŠ ä¸Šè¯¥æ ‡æ³¨ç¼–è¯‘å™¨ä¼šå¸®ä½ æ£€æŸ¥æ¥å£æ˜¯å¦ç¬¦åˆå‡½æ•°æ¥å£è§„èŒƒã€‚å°±åƒåŠ å…¥@Override æ ‡æ³¨ä¼šæ£€æŸ¥æ˜¯å¦é‡è½½äº†å‡½æ•°ä¸€æ ·ã€‚</p><p>æœ‰äº†ä¸Šè¿°æ¥å£å®šä¹‰ï¼Œå°±å¯ä»¥å†™å‡ºç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">ConsumerInterface</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> consumer <span class="token operator">=</span> str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¿›ä¸€æ­¥çš„ï¼Œè¿˜å¯ä»¥è¿™æ ·ä½¿ç”¨ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">class</span> <span class="token class-name">MyStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myForEach</span><span class="token punctuation">(</span><span class="token class-name">ConsumerInterface</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> consumer<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 1</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">T</span> t <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
      consumer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token class-name">MyStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyStream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">myForEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä½¿ç”¨è‡ªå®šä¹‰å‡½æ•°æ¥å£ä¹¦å†™Lambdaè¡¨è¾¾å¼</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ–¹æ³•å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•å¼•ç”¨" aria-hidden="true">#</a> æ–¹æ³•å¼•ç”¨</h3><p>æœ‰æ—¶å€™ Lambda è¡¨è¾¾å¼çš„ä»£ç å°±åªæ˜¯ä¸€ä¸ªç®€å•çš„æ–¹æ³•è°ƒç”¨è€Œå·²ï¼Œé‡åˆ°è¿™ç§æƒ…å†µï¼ŒLambda è¡¨è¾¾å¼è¿˜å¯ä»¥è¿›ä¸€æ­¥ç®€åŒ–ä¸º æ–¹æ³•å¼•ç”¨ï¼ˆMethod Referencesï¼‰ ã€‚ä¸€å…±æœ‰å››ç§å½¢å¼çš„æ–¹æ³•å¼•ç”¨ï¼Œ</p><ol><li>é™æ€æ–¹æ³•å¼•ç”¨</li></ol><p>å®ƒçš„è¯­æ³•æ˜¯ Class::static_method</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> ints <span class="token operator">=</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ints<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token class-name">Integer</span><span class="token operator">::</span><span class="token function">compare</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>ç‰¹å®šå¯¹è±¡çš„æ–¹æ³•å¼•ç”¨</li></ol><p>å®ƒçš„è¯­æ³•æ˜¯ instance::method å®ä¾‹å¦‚ä¸‹</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>cars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> police<span class="token operator">::</span><span class="token function">follow</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ol start="3"><li>ç‰¹å®šç±»çš„ä»»æ„å¯¹è±¡çš„æ–¹æ³•å¼•ç”¨</li></ol><p>å®ƒçš„è¯­æ³•æ˜¯ Class::method</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>words<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>word <span class="token operator">-&gt;</span> word<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// lambda</span>
words<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// method reference</span>

cars<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> <span class="token class-name">Car</span><span class="token operator">::</span><span class="token function">repair</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>æ„é€ å™¨å¼•ç”¨ ï¼Œä¾‹å¦‚ï¼š</li></ol><p>å®ƒçš„è¯­æ³•æ˜¯ Class::newï¼Œæˆ–è€…æ›´ä¸€èˆ¬çš„<code>Class&lt;T&gt;::new</code></p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// lambda</span>
words<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>word <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span>word<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// constructor reference</span>
words<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">StringBuilder</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lambda-and-anonymous-classes-ii" tabindex="-1"><a class="header-anchor" href="#lambda-and-anonymous-classes-ii" aria-hidden="true">#</a> Lambda and Anonymous Classes(II)</h2><p>è¯»è¿‡ä¸Šä¸€ç¯‡ä¹‹åï¼Œç›¸ä¿¡å¯¹ Lambda è¡¨è¾¾å¼çš„è¯­æ³•ä»¥åŠåŸºæœ¬åŸç†æœ‰äº†ä¸€å®šäº†è§£ã€‚å¯¹äºç¼–å†™ä»£ç ï¼Œæœ‰è¿™äº›çŸ¥è¯†å·²ç»å¤Ÿç”¨ã€‚æœ¬æ–‡å°†è¿›ä¸€æ­¥åŒºåˆ† Lambda è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»åœ¨ JVM å±‚é¢çš„åŒºåˆ«ï¼Œå¦‚æœå¯¹è¿™ä¸€éƒ¨åˆ†ä¸æ„Ÿå…´è¶£ï¼Œå¯ä»¥è·³è¿‡ã€‚</p><p>ç»è¿‡ç¬¬ä¸€ç¯‡çš„çš„ä»‹ç»ï¼Œæˆ‘ä»¬çœ‹åˆ° Lambda è¡¨è¾¾å¼ä¼¼ä¹åªæ˜¯ä¸ºäº†ç®€åŒ–åŒ¿åå†…éƒ¨ç±»ä¹¦å†™ï¼Œè¿™çœ‹èµ·æ¥ä»…ä»…é€šè¿‡è¯­æ³•ç³–åœ¨ç¼–è¯‘é˜¶æ®µæŠŠæ‰€æœ‰çš„ Lambda è¡¨è¾¾å¼æ›¿æ¢æˆåŒ¿åå†…éƒ¨ç±»å°±å¯ä»¥äº†ã€‚ä½†å®æ—¶å¹¶éå¦‚æ­¤ã€‚åœ¨ JVM å±‚é¢ï¼ŒLambda è¡¨è¾¾å¼å’ŒåŒ¿åå†…éƒ¨ç±»æœ‰ç€æ˜æ˜¾çš„å·®åˆ«ã€‚</p><h3 id="åŒ¿åå†…éƒ¨ç±»å®ç°" tabindex="-1"><a class="header-anchor" href="#åŒ¿åå†…éƒ¨ç±»å®ç°" aria-hidden="true">#</a> åŒ¿åå†…éƒ¨ç±»å®ç°</h3><p>åŒ¿åå†…éƒ¨ç±»ä»ç„¶æ˜¯ä¸€ä¸ªç±»ï¼Œåªæ˜¯ä¸éœ€è¦ç¨‹åºå‘˜æ˜¾ç¤ºæŒ‡å®šç±»åï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºè¯¥ç±»å–åã€‚å› æ­¤å¦‚æœæœ‰å¦‚ä¸‹å½¢å¼çš„ä»£ç ï¼Œç¼–è¯‘ä¹‹åå°†ä¼šäº§ç”Ÿä¸¤ä¸ª class æ–‡ä»¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAnonymousClass</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Runnable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token annotation punctuation">@Override</span>
      <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Anonymous Class Thread run()&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–è¯‘ä¹‹åæ–‡ä»¶åˆ†å¸ƒå¦‚ä¸‹ï¼Œä¸¤ä¸ª class æ–‡ä»¶åˆ†åˆ«æ˜¯ä¸»ç±»å’ŒåŒ¿åå†…éƒ¨ç±»äº§ç”Ÿçš„ï¼š</p><figure><img src="/v2/2-AnonymousClass.png" alt="1" tabindex="0" loading="lazy"><figcaption>1</figcaption></figure><p>è¿›ä¸€æ­¥åˆ†æä¸»ç±» MainAnonymousClass.class çš„å­—èŠ‚ç ï¼Œå¯å‘ç°å…¶åˆ›å»ºäº†åŒ¿åå†…éƒ¨ç±»çš„å¯¹è±¡ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// javap -c MainAnonymousClass.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainAnonymousClass</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">2</span>                  <span class="token comment">// class java/lang/Thread</span>
       <span class="token number">3</span><span class="token operator">:</span> dup
       <span class="token number">4</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">3</span>                  <span class="token comment">// class MainAnonymousClass$1 /*åˆ›å»ºå†…éƒ¨ç±»å¯¹è±¡*/</span>
       <span class="token number">7</span><span class="token operator">:</span> dup
       <span class="token number">8</span><span class="token operator">:</span> invokespecial #<span class="token number">4</span>                  <span class="token comment">// Method MainAnonymousClass$1.&quot;&lt;init&gt;&quot;:()V</span>
      <span class="token number">11</span><span class="token operator">:</span> invokespecial #<span class="token number">5</span>                  <span class="token comment">// Method java/lang/Thread.&quot;&lt;init&gt;&quot;:(Ljava/lang/Runnable;)V</span>
      <span class="token number">14</span><span class="token operator">:</span> invokevirtual #<span class="token number">6</span>                  <span class="token comment">// Method java/lang/Thread.start:()V</span>
      <span class="token number">17</span><span class="token operator">:</span> <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lambda-è¡¨è¾¾å¼å®ç°" tabindex="-1"><a class="header-anchor" href="#lambda-è¡¨è¾¾å¼å®ç°" aria-hidden="true">#</a> Lambda è¡¨è¾¾å¼å®ç°</h3><p>Lambda è¡¨è¾¾å¼é€šè¿‡ invokedynamic æŒ‡ä»¤å®ç°ï¼Œä¹¦å†™ Lambda è¡¨è¾¾å¼ä¸ä¼šäº§ç”Ÿæ–°çš„ç±»ã€‚å¦‚æœæœ‰å¦‚ä¸‹ä»£ç ï¼Œç¼–è¯‘ä¹‹ååªæœ‰ä¸€ä¸ª class æ–‡ä»¶ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainLambda</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>
        <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Lambda Thread run()&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç¼–è¯‘ä¹‹åçš„ç»“æœï¼š</p><figure><img src="/v2/2-Lambda.png" alt="2" tabindex="0" loading="lazy"><figcaption>2</figcaption></figure><p>é€šè¿‡ javap åç¼–è¯‘å‘½åï¼Œæˆ‘ä»¬æ›´èƒ½çœ‹å‡º Lambda è¡¨è¾¾å¼å†…éƒ¨è¡¨ç¤ºçš„ä¸åŒï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// javap -c -p MainLambda.class</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MainLambda</span> <span class="token punctuation">{</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>lang<span class="token punctuation">.</span></span>String</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> <span class="token keyword">new</span>           #<span class="token number">2</span>                  <span class="token comment">// class java/lang/Thread</span>
       <span class="token number">3</span><span class="token operator">:</span> dup
       <span class="token number">4</span><span class="token operator">:</span> invokedynamic #<span class="token number">3</span><span class="token punctuation">,</span>  <span class="token number">0</span>              <span class="token comment">// InvokeDynamic #0:run:()Ljava/lang/Runnable; /*ä½¿ç”¨invokedynamicæŒ‡ä»¤è°ƒç”¨*/</span>
       <span class="token number">9</span><span class="token operator">:</span> invokespecial #<span class="token number">4</span>                  <span class="token comment">// Method java/lang/Thread.&quot;&lt;init&gt;&quot;:(Ljava/lang/Runnable;)V</span>
      <span class="token number">12</span><span class="token operator">:</span> invokevirtual #<span class="token number">5</span>                  <span class="token comment">// Method java/lang/Thread.start:()V</span>
      <span class="token number">15</span><span class="token operator">:</span> <span class="token keyword">return</span>

  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">void</span> lambda$main$<span class="token function">0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">/*Lambdaè¡¨è¾¾å¼è¢«å°è£…æˆä¸»ç±»çš„ç§æœ‰æ–¹æ³•*/</span>
    <span class="token class-name">Code</span><span class="token operator">:</span>
       <span class="token number">0</span><span class="token operator">:</span> getstatic     #<span class="token number">6</span>                  <span class="token comment">// Field java/lang/System.out:Ljava/io/PrintStream;</span>
       <span class="token number">3</span><span class="token operator">:</span> ldc           #<span class="token number">7</span>                  <span class="token comment">// String Lambda Thread run()</span>
       <span class="token number">5</span><span class="token operator">:</span> invokevirtual #<span class="token number">8</span>                  <span class="token comment">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span>
       <span class="token number">8</span><span class="token operator">:</span> <span class="token keyword">return</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åç¼–è¯‘ä¹‹åæˆ‘ä»¬å‘ç° Lambda è¡¨è¾¾å¼è¢«å°è£…æˆäº†ä¸»ç±»çš„ä¸€ä¸ªç§æœ‰æ–¹æ³•ï¼Œå¹¶é€šè¿‡ invokedynamic æŒ‡ä»¤è¿›è¡Œè°ƒç”¨ã€‚</p><h3 id="æ¨è®º-this-å¼•ç”¨çš„æ„ä¹‰" tabindex="-1"><a class="header-anchor" href="#æ¨è®º-this-å¼•ç”¨çš„æ„ä¹‰" aria-hidden="true">#</a> æ¨è®ºï¼Œthis å¼•ç”¨çš„æ„ä¹‰</h3><p>æ—¢ç„¶ Lambda è¡¨è¾¾å¼ä¸æ˜¯å†…éƒ¨ç±»çš„ç®€å†™ï¼Œé‚£ä¹ˆ Lambda å†…éƒ¨çš„ this å¼•ç”¨ä¹Ÿå°±è·Ÿå†…éƒ¨ç±»å¯¹è±¡æ²¡ä»€ä¹ˆå…³ç³»äº†ã€‚åœ¨ Lambda è¡¨è¾¾å¼ä¸­ this çš„æ„ä¹‰è·Ÿåœ¨è¡¨è¾¾å¼å¤–éƒ¨å®Œå…¨ä¸€æ ·ã€‚å› æ­¤ä¸‹åˆ—ä»£ç å°†è¾“å‡ºä¸¤é Hello Hooleeï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªå¼•ç”¨åœ°å€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Hello</span> <span class="token punctuation">{</span>
  <span class="token class-name">Runnable</span> r1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token class-name">Runnable</span> r2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r1<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">new</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>r2<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;Hello Hoolee&quot;</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="lambda-and-collections" tabindex="-1"><a class="header-anchor" href="#lambda-and-collections" aria-hidden="true">#</a> Lambda and Collections</h2><p>æˆ‘ä»¬å…ˆä»æœ€ç†Ÿæ‚‰çš„ Java é›†åˆæ¡†æ¶(Java Collections Framework, JCF)å¼€å§‹è¯´èµ·ã€‚</p><p>ä¸ºå¼•å…¥ Lambda è¡¨è¾¾å¼ï¼ŒJava8 æ–°å¢äº† java.util.funcion åŒ…ï¼Œé‡Œé¢åŒ…å«å¸¸ç”¨çš„å‡½æ•°æ¥å£ï¼Œè¿™æ˜¯ Lambda è¡¨è¾¾å¼çš„åŸºç¡€ï¼ŒJava é›†åˆæ¡†æ¶ä¹Ÿæ–°å¢éƒ¨åˆ†æ¥å£ï¼Œä»¥ä¾¿ä¸ Lambda è¡¨è¾¾å¼å¯¹æ¥ã€‚</p><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹ Java é›†åˆæ¡†æ¶çš„æ¥å£ç»§æ‰¿ç»“æ„ï¼š</p><figure><img src="/v2/JCF_Collection_Interfaces.png" alt="3" tabindex="0" loading="lazy"><figcaption>3</figcaption></figure><p>ä¸Šå›¾ä¸­ç»¿è‰²æ ‡æ³¨çš„æ¥å£ç±»ï¼Œè¡¨ç¤ºåœ¨ Java8 ä¸­åŠ å…¥äº†æ–°çš„æ¥å£æ–¹æ³•ï¼Œå½“ç„¶ç”±äºç»§æ‰¿å…³ç³»ï¼Œä»–ä»¬ç›¸åº”çš„å­ç±»ä¹Ÿéƒ½ä¼šç»§æ‰¿è¿™äº›æ–°æ–¹æ³•ã€‚ä¸‹è¡¨è¯¦ç»†åˆ—ä¸¾äº†è¿™äº›æ–¹æ³•ã€‚</p><table><thead><tr><th style="text-align:left;">æ¥å£å</th><th style="text-align:left;">Java8 æ–°åŠ å…¥çš„æ–¹æ³•</th></tr></thead><tbody><tr><td style="text-align:left;">Collection</td><td style="text-align:left;">removeIf() spliterator() stream() parallelStream() forEach()</td></tr><tr><td style="text-align:left;">List</td><td style="text-align:left;">replaceAll() sort()</td></tr><tr><td style="text-align:left;">Map</td><td style="text-align:left;">getOrDefault() forEach() replaceAll() putIfAbsent() remove() replace() computeIfAbsent() computeIfPresent() compute() merge()</td></tr></tbody></table><p>è¿™äº›æ–°åŠ å…¥çš„æ–¹æ³•å¤§éƒ¨åˆ†è¦ç”¨åˆ° java.util.function åŒ…ä¸‹çš„æ¥å£ï¼Œè¿™æ„å‘³ç€è¿™äº›æ–¹æ³•å¤§éƒ¨åˆ†éƒ½è·Ÿ Lambda è¡¨è¾¾å¼ç›¸å…³ã€‚æˆ‘ä»¬å°†é€ä¸€å­¦ä¹ è¿™äº›æ–¹æ³•ã€‚</p><h3 id="collection-ä¸­çš„æ–°æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#collection-ä¸­çš„æ–°æ–¹æ³•" aria-hidden="true">#</a> Collection ä¸­çš„æ–°æ–¹æ³•</h3><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæ¥å£ Collection å’Œ List æ–°åŠ å…¥äº†ä¸€äº›æ–¹æ³•ï¼Œæˆ‘ä»¬ä»¥æ˜¯ List çš„å­ç±» ArrayList ä¸ºä¾‹æ¥è¯´æ˜ã€‚äº†è§£ Java7ArrayList å®ç°åŸç†ï¼Œå°†æœ‰åŠ©äºç†è§£ä¸‹æ–‡ã€‚</p><h4 id="foreach" tabindex="-1"><a class="header-anchor" href="#foreach" aria-hidden="true">#</a> forEach()</h4><p>è¯¥æ–¹æ³•çš„ç­¾åä¸º void forEach(Consumer&lt;? super E&gt; action)ï¼Œä½œç”¨æ˜¯å¯¹å®¹å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œ action æŒ‡å®šçš„åŠ¨ä½œï¼Œå…¶ä¸­ Consumer æ˜¯ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• void accept(T t)ï¼ˆåé¢æˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œè¿™ä¸ªæ–¹æ³•å«ä»€ä¹ˆæ ¹æœ¬ä¸é‡è¦ï¼Œä½ ç”šè‡³ä¸éœ€è¦è®°å¿†å®ƒçš„åå­—ï¼‰ã€‚</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œéœ€è¦æ‰“å°å‡ºå…¶ä¸­æ‰€æœ‰é•¿åº¦å¤§äº 3 çš„å­—ç¬¦ä¸².</p><p>Java7 åŠä»¥å‰æˆ‘ä»¬å¯ä»¥ç”¨å¢å¼ºçš„ for å¾ªç¯å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨æ›¾å¼ºforå¾ªç¯è¿­ä»£</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> str <span class="token operator">:</span> list<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ä½¿ç”¨ forEach()æ–¹æ³•ç»“åˆåŒ¿åå†…éƒ¨ç±»ï¼Œå¯ä»¥è¿™æ ·å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨forEach()ç»“åˆåŒ¿åå†…éƒ¨ç±»è¿­ä»£</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è°ƒç”¨ forEach()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç° Comsumer æ¥å£ã€‚åˆ°ç›®å‰ä¸ºæ­¢æˆ‘ä»¬æ²¡çœ‹åˆ°è¿™ç§è®¾è®¡æœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä½†æ˜¯ä¸è¦å¿˜è®° Lambda è¡¨è¾¾å¼ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨forEach()ç»“åˆLambdaè¡¨è¾¾å¼è¿­ä»£</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span> str <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ç»™ forEach()æ–¹æ³•ä¼ å…¥ä¸€ä¸ª Lambda è¡¨è¾¾å¼ï¼Œæˆ‘ä»¬ä¸éœ€è¦çŸ¥é“ accept()æ–¹æ³•ï¼Œä¹Ÿä¸éœ€è¦çŸ¥é“ Consumer æ¥å£ï¼Œç±»å‹æ¨å¯¼å¸®æˆ‘ä»¬åšäº†ä¸€åˆ‡ã€‚</p><h4 id="removeif" tabindex="-1"><a class="header-anchor" href="#removeif" aria-hidden="true">#</a> removeIf()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º boolean removeIf(Predicate&lt;? super E&gt; filter)ï¼Œä½œç”¨æ˜¯åˆ é™¤å®¹å™¨ä¸­æ‰€æœ‰æ»¡è¶³ filter æŒ‡å®šæ¡ä»¶çš„å…ƒç´ ï¼Œå…¶ä¸­ Predicate æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• boolean test(T t)ï¼ŒåŒæ ·çš„è¿™ä¸ªæ–¹æ³•çš„åå­—æ ¹æœ¬ä¸é‡è¦ï¼Œå› ä¸ºç”¨çš„æ—¶å€™ä¸éœ€è¦ä¹¦å†™è¿™ä¸ªåå­—ã€‚</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œéœ€è¦åˆ é™¤å…¶ä¸­æ‰€æœ‰é•¿åº¦å¤§äº 3 çš„å­—ç¬¦ä¸²ã€‚</p><p>æˆ‘ä»¬çŸ¥é“å¦‚æœéœ€è¦åœ¨è¿­ä»£è¿‡ç¨‹å†²å¯¹å®¹å™¨è¿›è¡Œåˆ é™¤æ“ä½œå¿…é¡»ä½¿ç”¨è¿­ä»£å™¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º ConcurrentModificationExceptionï¼Œæ‰€ä»¥ä¸Šè¿°ä»»åŠ¡ä¼ ç»Ÿçš„å†™æ³•æ˜¯ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨è¿­ä»£å™¨åˆ é™¤åˆ—è¡¨å…ƒç´ </span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Iterator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> it <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>it<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment">// åˆ é™¤é•¿åº¦å¤§äº3çš„å…ƒç´ </span>
        it<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ä½¿ç”¨ removeIf()æ–¹æ³•ç»“åˆåŒ¿åå†…éƒ¨ç±»ï¼Œæˆ‘ä»¬å¯æ˜¯è¿™æ ·å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨removeIf()ç»“åˆåŒ¿ååå†…éƒ¨ç±»å®ç°</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">removeIf</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Predicate</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// åˆ é™¤é•¿åº¦å¤§äº3çš„å…ƒç´ </span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">test</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä½¿ç”¨ removeIf()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç° Precicate æ¥å£ã€‚ç›¸ä¿¡ä½ å·²ç»æƒ³åˆ°ç”¨ Lambda è¡¨è¾¾å¼è¯¥æ€ä¹ˆå†™äº†ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨removeIf()ç»“åˆLambdaè¡¨è¾¾å¼å®ç°</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">removeIf</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// åˆ é™¤é•¿åº¦å¤§äº3çš„å…ƒç´ </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä¸éœ€è¦è®°å¿† Predicate æ¥å£åï¼Œä¹Ÿä¸éœ€è¦è®°å¿† test()æ–¹æ³•åï¼Œåªéœ€è¦çŸ¥é“æ­¤å¤„éœ€è¦ä¸€ä¸ªè¿”å›å¸ƒå°”ç±»å‹çš„ Lambda è¡¨è¾¾å¼å°±è¡Œäº†ã€‚</p><h4 id="replaceall" tabindex="-1"><a class="header-anchor" href="#replaceall" aria-hidden="true">#</a> replaceAll()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º<code>void replaceAll(UnaryOperator&lt;E&gt; operator)</code>ï¼Œä½œç”¨æ˜¯å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œ operator æŒ‡å®šçš„æ“ä½œï¼Œå¹¶ç”¨æ“ä½œç»“æœæ¥æ›¿æ¢åŸæ¥çš„å…ƒç´ ã€‚å…¶ä¸­ UnaryOperator æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå¾…å®ç°å‡½æ•° T apply(T t)ã€‚</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå°†å…¶ä¸­æ‰€æœ‰é•¿åº¦å¤§äº 3 çš„å…ƒç´ è½¬æ¢æˆå¤§å†™ï¼Œå…¶ä½™å…ƒç´ ä¸å˜ã€‚</p><p>Java7 åŠä¹‹å‰ä¼¼ä¹æ²¡æœ‰ä¼˜é›…çš„åŠæ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨ä¸‹æ ‡å®ç°å…ƒç´ æ›¿æ¢</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
        list<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ replaceAll()æ–¹æ³•ç»“åˆåŒ¿åå†…éƒ¨ç±»å¯ä»¥å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç°</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">UnaryOperator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">String</span> str<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> str<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è°ƒç”¨ replaceAll()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç° UnaryOperator æ¥å£ã€‚æˆ‘ä»¬çŸ¥é“å¯ä»¥ç”¨æ›´ä¸ºç®€æ´çš„ Lambda è¡¨è¾¾å¼å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨Lambdaè¡¨è¾¾å¼å®ç°</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">3</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> str<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="sort" tabindex="-1"><a class="header-anchor" href="#sort" aria-hidden="true">#</a> sort()</h4><p>è¯¥æ–¹æ³•å®šä¹‰åœ¨ List æ¥å£ä¸­ï¼Œæ–¹æ³•ç­¾åä¸º void sort(Comparator&lt;? super E&gt; c)ï¼Œè¯¥æ–¹æ³•æ ¹æ® c æŒ‡å®šçš„æ¯”è¾ƒè§„åˆ™å¯¹å®¹å™¨å…ƒç´ è¿›è¡Œæ’åºã€‚Comparator æ¥å£æˆ‘ä»¬å¹¶ä¸é™Œç”Ÿï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªæ–¹æ³• int compare(T o1, T o2)éœ€è¦å®ç°ï¼Œæ˜¾ç„¶è¯¥æ¥å£æ˜¯ä¸ªå‡½æ•°æ¥å£ã€‚</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²åˆ—è¡¨ï¼ŒæŒ‰ç…§å­—ç¬¦ä¸²é•¿åº¦å¢åºå¯¹å…ƒç´ æ’åºã€‚</p><p>ç”±äº Java7 ä»¥åŠä¹‹å‰ sort()æ–¹æ³•åœ¨ Collections å·¥å…·ç±»ä¸­ï¼Œæ‰€ä»¥ä»£ç è¦è¿™æ ·å†™ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Collections.sort()æ–¹æ³•</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>list<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">String</span> str1<span class="token punctuation">,</span> <span class="token class-name">String</span> str2<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> str1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>str2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨å¯ä»¥ç›´æ¥ä½¿ç”¨ List.sort()æ–¹æ³•ï¼Œç»“åˆ Lambda è¡¨è¾¾å¼ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// List.sort()æ–¹æ³•ç»“åˆLambdaè¡¨è¾¾å¼</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> str1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>str2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="spliterator" tabindex="-1"><a class="header-anchor" href="#spliterator" aria-hidden="true">#</a> spliterator()</h4><p>æ–¹æ³•ç­¾åä¸º<code>Spliterator&lt;E&gt; spliterator()</code>ï¼Œè¯¥æ–¹æ³•è¿”å›å®¹å™¨çš„å¯æ‹†åˆ†è¿­ä»£å™¨ã€‚ä»åå­—æ¥çœ‹è¯¥æ–¹æ³•è·Ÿ iterator()æ–¹æ³•æœ‰ç‚¹åƒï¼Œæˆ‘ä»¬çŸ¥é“ Iterator æ˜¯ç”¨æ¥è¿­ä»£å®¹å™¨çš„ï¼ŒSpliterator ä¹Ÿæœ‰ç±»ä¼¼ä½œç”¨ï¼Œä½†äºŒè€…æœ‰å¦‚ä¸‹ä¸åŒï¼š</p><p>Spliterator æ—¢å¯ä»¥åƒ Iterator é‚£æ ·é€ä¸ªè¿­ä»£ï¼Œä¹Ÿå¯ä»¥æ‰¹é‡è¿­ä»£ã€‚æ‰¹é‡è¿­ä»£å¯ä»¥é™ä½è¿­ä»£çš„å¼€é”€ã€‚ Spliterator æ˜¯å¯æ‹†åˆ†çš„ï¼Œä¸€ä¸ª Spliterator å¯ä»¥é€šè¿‡è°ƒç”¨<code>Spliterator&lt;T&gt;</code> trySplit()æ–¹æ³•æ¥å°è¯•åˆ†æˆä¸¤ä¸ªã€‚ä¸€ä¸ªæ˜¯ thisï¼Œå¦ä¸€ä¸ªæ˜¯æ–°è¿”å›çš„é‚£ä¸ªï¼Œè¿™ä¸¤ä¸ªè¿­ä»£å™¨ä»£è¡¨çš„å…ƒç´ æ²¡æœ‰é‡å ã€‚ å¯é€šè¿‡ï¼ˆå¤šæ¬¡ï¼‰è°ƒç”¨ Spliterator.trySplit()æ–¹æ³•æ¥åˆ†è§£è´Ÿè½½ï¼Œä»¥ä¾¿å¤šçº¿ç¨‹å¤„ç†ã€‚</p><h4 id="stream-å’Œ-parallelstream" tabindex="-1"><a class="header-anchor" href="#stream-å’Œ-parallelstream" aria-hidden="true">#</a> stream()å’Œ parallelStream()</h4><p>stream()å’Œ parallelStream()åˆ†åˆ«è¿”å›è¯¥å®¹å™¨çš„ Stream è§†å›¾è¡¨ç¤ºï¼Œä¸åŒä¹‹å¤„åœ¨äº parallelStream()è¿”å›å¹¶è¡Œçš„ Streamã€‚Stream æ˜¯ Java å‡½æ•°å¼ç¼–ç¨‹çš„æ ¸å¿ƒç±»ï¼Œæˆ‘ä»¬ä¼šåœ¨åé¢ç« èŠ‚ä¸­å­¦ä¹ ã€‚</p><h3 id="map-ä¸­çš„æ–°æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#map-ä¸­çš„æ–°æ–¹æ³•" aria-hidden="true">#</a> Map ä¸­çš„æ–°æ–¹æ³•</h3><p>ç›¸æ¯” Collectionï¼ŒMap ä¸­åŠ å…¥äº†æ›´å¤šçš„æ–¹æ³•ï¼Œæˆ‘ä»¬ä»¥ HashMap ä¸ºä¾‹æ¥é€ä¸€æ¢ç§˜ã€‚äº†è§£ Java7HashMap å®ç°åŸç†ï¼Œå°†æœ‰åŠ©äºç†è§£ä¸‹æ–‡ã€‚</p><h4 id="foreach-1" tabindex="-1"><a class="header-anchor" href="#foreach-1" aria-hidden="true">#</a> forEach()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º void forEach(BiConsumer&lt;? super K,? super V&gt; action)ï¼Œä½œç”¨æ˜¯å¯¹ Map ä¸­çš„æ¯ä¸ªæ˜ å°„æ‰§è¡Œ action æŒ‡å®šçš„æ“ä½œï¼Œå…¶ä¸­ BiConsumer æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• void accept(T t, U u)ã€‚BinConsumer æ¥å£åå­—å’Œ accept()æ–¹æ³•åå­—éƒ½ä¸é‡è¦ï¼Œè¯·ä¸è¦è®°å¿†ä»–ä»¬ã€‚</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªæ•°å­—åˆ°å¯¹åº”è‹±æ–‡å•è¯çš„ Mapï¼Œè¯·è¾“å‡º Map ä¸­çš„æ‰€æœ‰æ˜ å°„å…³ç³»ï¼</p><p>Java7 ä»¥åŠä¹‹å‰ç»å…¸çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Java7ä»¥åŠä¹‹å‰è¿­ä»£Map</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ Map.forEach()æ–¹æ³•ï¼Œç»“åˆåŒ¿åå†…éƒ¨ç±»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨forEach()ç»“åˆåŒ¿åå†…éƒ¨ç±»è¿­ä»£Map</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BiConsumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> k<span class="token punctuation">,</span> <span class="token class-name">String</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è°ƒç”¨ forEach()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç° BiConsumer æ¥å£ã€‚å½“ç„¶ï¼Œå®é™…åœºæ™¯ä¸­æ²¡äººä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å†™æ³•ï¼Œå› ä¸ºæœ‰ Lambda è¡¨è¾¾å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨forEach()ç»“åˆLambdaè¡¨è¾¾å¼è¿­ä»£Map</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>k <span class="token operator">+</span> <span class="token string">&quot;=&quot;</span> <span class="token operator">+</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="getordefault" tabindex="-1"><a class="header-anchor" href="#getordefault" aria-hidden="true">#</a> getOrDefault()</h4><p>è¯¥æ–¹æ³•è·Ÿ Lambda è¡¨è¾¾å¼æ²¡å…³ç³»ï¼Œä½†æ˜¯å¾ˆæœ‰ç”¨ã€‚æ–¹æ³•ç­¾åä¸º V getOrDefault(Object key, V defaultValue)ï¼Œä½œç”¨æ˜¯æŒ‰ç…§ç»™å®šçš„ key æŸ¥è¯¢ Map ä¸­å¯¹åº”çš„ valueï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åˆ™è¿”å› defaultValueã€‚ä½¿ç”¨è¯¥æ–¹æ³•ç¨‹åºå‘˜å¯ä»¥çœå»æŸ¥è¯¢æŒ‡å®šé”®å€¼æ˜¯å¦å­˜åœ¨çš„éº»çƒ¦ï¼</p><p>éœ€æ±‚ï¼›å‡è®¾æœ‰ä¸€ä¸ªæ•°å­—åˆ°å¯¹åº”è‹±æ–‡å•è¯çš„ Mapï¼Œè¾“å‡º 4 å¯¹åº”çš„è‹±æ–‡å•è¯ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™è¾“å‡º NoValue</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æŸ¥è¯¢Mapä¸­æŒ‡å®šçš„å€¼ï¼Œä¸å­˜åœ¨æ—¶ä½¿ç”¨é»˜è®¤å€¼</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Java7ä»¥åŠä¹‹å‰åšæ³•</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">// 1</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;NoValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Java8ä½¿ç”¨Map.getOrDefault()</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">getOrDefault</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;NoValue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="putifabsent" tabindex="-1"><a class="header-anchor" href="#putifabsent" aria-hidden="true">#</a> putIfAbsent()</h4><p>è¯¥æ–¹æ³•è·Ÿ Lambda è¡¨è¾¾å¼æ²¡å…³ç³»ï¼Œä½†æ˜¯å¾ˆæœ‰ç”¨ã€‚æ–¹æ³•ç­¾åä¸º V putIfAbsent(K key, V value)ï¼Œä½œç”¨æ˜¯åªæœ‰åœ¨ä¸å­˜åœ¨ key å€¼çš„æ˜ å°„æˆ–æ˜ å°„å€¼ä¸º null æ—¶ï¼Œæ‰å°† value æŒ‡å®šçš„å€¼æ”¾å…¥åˆ° Map ä¸­ï¼Œå¦åˆ™ä¸å¯¹ Map åšæ›´æ”¹ï¼è¯¥æ–¹æ³•å°†æ¡ä»¶åˆ¤æ–­å’Œèµ‹å€¼åˆäºŒä¸ºä¸€ï¼Œä½¿ç”¨èµ·æ¥æ›´åŠ æ–¹ä¾¿ï¼</p><h4 id="remove" tabindex="-1"><a class="header-anchor" href="#remove" aria-hidden="true">#</a> remove()</h4><p>æˆ‘ä»¬éƒ½çŸ¥é“ Map ä¸­æœ‰ä¸€ä¸ª remove(Object key)æ–¹æ³•ï¼Œæ¥æ ¹æ®æŒ‡å®š key å€¼åˆ é™¤ Map ä¸­çš„æ˜ å°„å…³ç³»ï¼›Java8 æ–°å¢äº† remove(Object key, Object value)æ–¹æ³•ï¼Œåªæœ‰åœ¨å½“å‰ Map ä¸­ key æ­£å¥½æ˜ å°„åˆ° value æ—¶æ‰åˆ é™¤è¯¥æ˜ å°„ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼</p><h4 id="replace" tabindex="-1"><a class="header-anchor" href="#replace" aria-hidden="true">#</a> replace()</h4><p>åœ¨ Java7 åŠä»¥å‰ï¼Œè¦æƒ³æ›¿æ¢ Map ä¸­çš„æ˜ å°„å…³ç³»å¯é€šè¿‡ put(K key, V value)æ–¹æ³•å®ç°ï¼Œè¯¥æ–¹æ³•æ€»æ˜¯ä¼šç”¨æ–°å€¼æ›¿æ¢åŸæ¥çš„å€¼ï¼ä¸ºäº†æ›´ç²¾ç¡®çš„æ§åˆ¶æ›¿æ¢è¡Œä¸ºï¼ŒJava8 åœ¨ Map ä¸­åŠ å…¥äº†ä¸¤ä¸ª replace()æ–¹æ³•ï¼Œåˆ†åˆ«å¦‚ä¸‹ï¼š</p><ul><li>replace(K key, V value)ï¼Œåªæœ‰åœ¨å½“å‰ Map ä¸­ key çš„æ˜ å°„å­˜åœ¨æ—¶æ‰ç”¨ value å»æ›¿æ¢åŸæ¥çš„å€¼ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼</li><li>replace(K key, V oldValue, V newValue)ï¼Œåªæœ‰åœ¨å½“å‰ Map ä¸­ key çš„æ˜ å°„å­˜åœ¨ä¸”ç­‰äº oldValue æ—¶æ‰ç”¨ newValue å»æ›¿æ¢åŸæ¥çš„å€¼ï¼Œå¦åˆ™ä»€ä¹ˆä¹Ÿä¸åšï¼ replaceAll()</li></ul><p>è¯¥æ–¹æ³•ç­¾åä¸º replaceAll(BiFunction&lt;? super K,? super V,? extends V&gt; function)ï¼Œä½œç”¨æ˜¯å¯¹ Map ä¸­çš„æ¯ä¸ªæ˜ å°„æ‰§è¡Œ function æŒ‡å®šçš„æ“ä½œï¼Œå¹¶ç”¨ function çš„æ‰§è¡Œç»“æœæ›¿æ¢åŸæ¥çš„ valueï¼Œå…¶ä¸­ BiFunction æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• R apply(T t, U u)ï¼ä¸è¦è¢«å¦‚æ­¤å¤šçš„å‡½æ•°æ¥å£å“åˆ°ï¼Œå› ä¸ºä½¿ç”¨çš„æ—¶å€™æ ¹æœ¬ä¸éœ€è¦çŸ¥é“ä»–ä»¬çš„åå­—ï¼</p><p>éœ€æ±‚ï¼šå‡è®¾æœ‰ä¸€ä¸ªæ•°å­—åˆ°å¯¹åº”è‹±æ–‡å•è¯çš„ Mapï¼Œè¯·å°†åŸæ¥æ˜ å°„å…³ç³»ä¸­çš„å•è¯éƒ½è½¬æ¢æˆå¤§å†™ï¼</p><p>Java7 ä»¥åŠä¹‹å‰ç»å…¸çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Java7ä»¥åŠä¹‹å‰æ›¿æ¢æ‰€æœ‰Mapä¸­æ‰€æœ‰æ˜ å°„å…³ç³»</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">Map<span class="token punctuation">.</span>Entry</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> entry <span class="token operator">:</span> map<span class="token punctuation">.</span><span class="token function">entrySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    entry<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>entry<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ replaceAll()æ–¹æ³•ç»“åˆåŒ¿åå†…éƒ¨ç±»ï¼Œå®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨replaceAll()ç»“åˆåŒ¿åå†…éƒ¨ç±»å®ç°</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BiFunction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">apply</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> k<span class="token punctuation">,</span> <span class="token class-name">String</span> v<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç è°ƒç”¨ replaceAll()æ–¹æ³•ï¼Œå¹¶ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»å®ç° BiFunction æ¥å£ã€‚æ›´è¿›ä¸€æ­¥çš„ï¼Œä½¿ç”¨ Lambda è¡¨è¾¾å¼å®ç°å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨replaceAll()ç»“åˆLambdaè¡¨è¾¾å¼å®ç°</span>
<span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;two&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;three&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
map<span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç®€æ´åˆ°è®©äººéš¾ä»¥ç½®ä¿¡ï¼</p><h4 id="merge" tabindex="-1"><a class="header-anchor" href="#merge" aria-hidden="true">#</a> merge()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º merge(K key, V value, BiFunction&lt;? super V,? super V,? extends V&gt; remappingFunction)ï¼Œä½œç”¨æ˜¯ï¼š</p><ul><li>å¦‚æœ Map ä¸­ key å¯¹åº”çš„æ˜ å°„ä¸å­˜åœ¨æˆ–è€…ä¸º nullï¼Œåˆ™å°† valueï¼ˆä¸èƒ½æ˜¯ nullï¼‰å…³è”åˆ° key ä¸Šï¼›</li><li>å¦åˆ™æ‰§è¡Œ remappingFunctionï¼Œå¦‚æœæ‰§è¡Œç»“æœé null åˆ™ç”¨è¯¥ç»“æœè·Ÿ key å…³è”ï¼Œå¦åˆ™åœ¨ Map ä¸­åˆ é™¤ key çš„æ˜ å°„ï¼ å‚æ•°ä¸­ BiFunction å‡½æ•°æ¥å£å‰é¢å·²ç»ä»‹ç»è¿‡ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• R apply(T t, U u)ï¼</li></ul><p>merge()æ–¹æ³•è™½ç„¶è¯­ä¹‰æœ‰äº›å¤æ‚ï¼Œä½†è¯¥æ–¹æ³•çš„ç”¨æ–¹å¼å¾ˆæ˜ç¡®ï¼Œä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„åœºæ™¯æ˜¯å°†æ–°çš„é”™è¯¯ä¿¡æ¯æ‹¼æ¥åˆ°åŸæ¥çš„ä¿¡æ¯ä¸Šï¼Œæ¯”å¦‚ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>map<span class="token punctuation">.</span><span class="token function">merge</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newMsg<span class="token punctuation">,</span> <span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v1<span class="token operator">+</span>v2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="compute" tabindex="-1"><a class="header-anchor" href="#compute" aria-hidden="true">#</a> compute()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º compute(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction)ï¼Œä½œç”¨æ˜¯æŠŠ remappingFunction çš„è®¡ç®—ç»“æœå…³è”åˆ° key ä¸Šï¼Œå¦‚æœè®¡ç®—ç»“æœä¸º nullï¼Œåˆ™åœ¨ Map ä¸­åˆ é™¤ key çš„æ˜ å°„ï¼</p><p>è¦å®ç°ä¸Šè¿° merge()æ–¹æ³•ä¸­é”™è¯¯ä¿¡æ¯æ‹¼æ¥çš„ä¾‹å­ï¼Œä½¿ç”¨ compute()ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>map<span class="token punctuation">.</span><span class="token function">compute</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>v<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> v<span class="token operator">==</span><span class="token keyword">null</span> <span class="token operator">?</span> newMsg <span class="token operator">:</span> v<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>newMsg<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="computeifabsent" tabindex="-1"><a class="header-anchor" href="#computeifabsent" aria-hidden="true">#</a> computeIfAbsent()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º V computeIfAbsent(K key, Function&lt;? super K,? extends V&gt; mappingFunction)ï¼Œä½œç”¨æ˜¯ï¼šåªæœ‰åœ¨å½“å‰ Map ä¸­ä¸å­˜åœ¨ key å€¼çš„æ˜ å°„æˆ–æ˜ å°„å€¼ä¸º null æ—¶ï¼Œæ‰è°ƒç”¨ mappingFunctionï¼Œå¹¶åœ¨ mappingFunction æ‰§è¡Œç»“æœé null æ—¶ï¼Œå°†ç»“æœè·Ÿ key å…³è”ï¼</p><p>Function æ˜¯ä¸€ä¸ªå‡½æ•°æ¥å£ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªå¾…å®ç°æ–¹æ³• R apply(T t)ï¼</p><p>computeIfAbsent()å¸¸ç”¨æ¥å¯¹ Map çš„æŸä¸ª key å€¼å»ºç«‹åˆå§‹åŒ–æ˜ å°„ï¼æ¯”å¦‚æˆ‘ä»¬è¦å®ç°ä¸€ä¸ªå¤šå€¼æ˜ å°„ï¼ŒMap çš„å®šä¹‰å¯èƒ½æ˜¯<code>Map&lt;K,Set&lt;V&gt;&gt;</code>ï¼Œè¦å‘ Map ä¸­æ”¾å…¥æ–°å€¼ï¼Œå¯é€šè¿‡å¦‚ä¸‹ä»£ç å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">,</span> <span class="token class-name">Set</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// Java7åŠä»¥å‰çš„å®ç°æ–¹å¼</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">containsKey</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> valueSet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    valueSet<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;one&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> valueSet<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>// Java8 çš„å®ç°æ–¹å¼</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>map<span class="token punctuation">.</span><span class="token function">computeIfAbsent</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> v <span class="token operator">-&gt;</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&quot;yi&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä½¿ç”¨ computeIfAbsent()å°†æ¡ä»¶åˆ¤æ–­å’Œæ·»åŠ æ“ä½œåˆäºŒä¸ºä¸€ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´ï¼</p><h4 id="computeifpresent" tabindex="-1"><a class="header-anchor" href="#computeifpresent" aria-hidden="true">#</a> computeIfPresent()</h4><p>è¯¥æ–¹æ³•ç­¾åä¸º V computeIfPresent(K key, BiFunction&lt;? super K,? super V,? extends V&gt; remappingFunction)ï¼Œä½œç”¨è·Ÿ computeIfAbsent()ç›¸åï¼Œå³ï¼Œåªæœ‰åœ¨å½“å‰ Map ä¸­å­˜åœ¨ key å€¼çš„æ˜ å°„ä¸”é null æ—¶ï¼Œæ‰è°ƒç”¨ remappingFunctionï¼Œå¦‚æœ remappingFunction æ‰§è¡Œç»“æœä¸º nullï¼Œåˆ™åˆ é™¤ key çš„æ˜ å°„ï¼Œå¦åˆ™ä½¿ç”¨è¯¥ç»“æœæ›¿æ¢ key åŸæ¥çš„æ˜ å°„ï¼</p><p>è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½è·Ÿå¦‚ä¸‹ä»£ç æ˜¯ç­‰æ•ˆçš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Java7åŠä»¥å‰è·ŸcomputeIfPresent()ç­‰æ•ˆçš„ä»£ç </span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">V</span> oldValue <span class="token operator">=</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">V</span> newValue <span class="token operator">=</span> remappingFunction<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> oldValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        map<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> newValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Java8 ä¸ºå®¹å™¨æ–°å¢ä¸€äº›æœ‰ç”¨çš„æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•æœ‰äº›æ˜¯ä¸ºå®Œå–„åŸæœ‰åŠŸèƒ½ï¼Œæœ‰äº›æ˜¯ä¸ºå¼•å…¥å‡½æ•°å¼ç¼–ç¨‹ï¼Œå­¦ä¹ å’Œä½¿ç”¨è¿™äº›æ–¹æ³•æœ‰åŠ©äºæˆ‘ä»¬å†™å‡ºæ›´åŠ ç®€æ´æœ‰æ•ˆçš„ä»£ç ï¼ å‡½æ•°æ¥å£è™½ç„¶å¾ˆå¤šï¼Œä½†ç»å¤§å¤šæ•°æ—¶å€™æˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦çŸ¥é“å®ƒä»¬çš„åå­—ï¼Œä¹¦å†™ Lambda è¡¨è¾¾å¼æ—¶ç±»å‹æ¨æ–­å¸®æˆ‘ä»¬åšäº†ä¸€åˆ‡</p><h2 id="streams-api-i" tabindex="-1"><a class="header-anchor" href="#streams-api-i" aria-hidden="true">#</a> Streams API(I)</h2><p>ä½ å¯èƒ½æ²¡æ„è¯†åˆ° Java å¯¹å‡½æ•°å¼ç¼–ç¨‹çš„é‡è§†ç¨‹åº¦ï¼Œçœ‹çœ‹ Java 8 åŠ å…¥å‡½æ•°å¼ç¼–ç¨‹æ‰©å……å¤šå°‘åŠŸèƒ½å°±æ¸…æ¥šäº†ã€‚Java 8 ä¹‹æ‰€ä»¥è´¹è¿™ä¹ˆå¤§åŠŸå¤«å¼•å…¥å‡½æ•°å¼ç¼–ç¨‹ï¼ŒåŸå› æœ‰äºŒï¼š</p><ul><li>ä»£ç ç®€æ´å‡½æ•°å¼ç¼–ç¨‹å†™å‡ºçš„ä»£ç ç®€æ´ä¸”æ„å›¾æ˜ç¡®ï¼Œä½¿ç”¨ stream æ¥å£è®©ä½ ä»æ­¤å‘Šåˆ« for å¾ªç¯ã€‚</li><li>å¤šæ ¸å‹å¥½ï¼ŒJava å‡½æ•°å¼ç¼–ç¨‹ä½¿å¾—ç¼–å†™å¹¶è¡Œç¨‹åºä»æœªå¦‚æ­¤ç®€å•ï¼Œä½ éœ€è¦çš„å…¨éƒ¨å°±æ˜¯è°ƒç”¨ä¸€ä¸‹ parallel()æ–¹æ³•ã€‚</li></ul><p>è¿™ä¸€èŠ‚æˆ‘ä»¬å­¦ä¹  streamï¼Œä¹Ÿå°±æ˜¯ Java å‡½æ•°å¼ç¼–ç¨‹çš„ä¸»è§’ã€‚å¯¹äº Java 7 æ¥è¯´ stream å®Œå…¨æ˜¯ä¸ªé™Œç”Ÿä¸œè¥¿ï¼Œstream å¹¶ä¸æ˜¯æŸç§æ•°æ®ç»“æ„ï¼Œå®ƒåªæ˜¯æ•°æ®æºçš„ä¸€ç§è§†å›¾ã€‚è¿™é‡Œçš„æ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒJava å®¹å™¨æˆ– I/O channel ç­‰ã€‚æ­£å› å¦‚æ­¤è¦å¾—åˆ°ä¸€ä¸ª stream é€šå¸¸ä¸ä¼šæ‰‹åŠ¨åˆ›å»ºï¼Œè€Œæ˜¯è°ƒç”¨å¯¹åº”çš„å·¥å…·æ–¹æ³•ï¼Œæ¯”å¦‚ï¼š</p><ul><li>è°ƒç”¨ Collection.stream()æˆ–è€… Collection.parallelStream()æ–¹æ³•</li><li>è°ƒç”¨ Arrays.stream(T[] array)æ–¹æ³•</li></ul><p>å¸¸è§çš„ stream æ¥å£ç»§æ‰¿å…³ç³»å¦‚å›¾ï¼š</p><figure><img src="/v2/Java_stream_Interfaces.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å›¾ä¸­ 4 ç§ stream æ¥å£ç»§æ‰¿è‡ª BaseStreamï¼Œå…¶ä¸­ IntStream, LongStream, DoubleStream å¯¹åº”ä¸‰ç§åŸºæœ¬ç±»å‹ï¼ˆint, long, doubleï¼Œæ³¨æ„ä¸æ˜¯åŒ…è£…ç±»å‹ï¼‰ï¼ŒStream å¯¹åº”æ‰€æœ‰å‰©ä½™ç±»å‹çš„ stream è§†å›¾ã€‚ä¸ºä¸åŒæ•°æ®ç±»å‹è®¾ç½®ä¸åŒ stream æ¥å£ï¼Œå¯ä»¥ 1.æé«˜æ€§èƒ½ï¼Œ2.å¢åŠ ç‰¹å®šæ¥å£å‡½æ•°ã€‚</p><figure><img src="/v2/WRONG_Java_stream_Interfaces.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä½ å¯èƒ½ä¼šå¥‡æ€ªä¸ºä»€ä¹ˆä¸æŠŠ IntStream ç­‰è®¾è®¡æˆ Stream çš„å­æ¥å£ï¼Ÿæ¯•ç«Ÿè¿™æ¥å£ä¸­çš„æ–¹æ³•åå¤§éƒ¨åˆ†æ˜¯ä¸€æ ·çš„ã€‚ç­”æ¡ˆæ˜¯è¿™äº›æ–¹æ³•çš„åå­—è™½ç„¶ç›¸åŒï¼Œä½†æ˜¯è¿”å›ç±»å‹ä¸åŒï¼Œå¦‚æœè®¾è®¡æˆçˆ¶å­æ¥å£å…³ç³»ï¼Œè¿™äº›æ–¹æ³•å°†ä¸èƒ½å…±å­˜ï¼Œå› ä¸º Java ä¸å…è®¸åªæœ‰è¿”å›ç±»å‹ä¸åŒçš„æ–¹æ³•é‡è½½ã€‚</p><p>è™½ç„¶å¤§éƒ¨åˆ†æƒ…å†µä¸‹ stream æ˜¯å®¹å™¨è°ƒç”¨ Collection.stream()æ–¹æ³•å¾—åˆ°çš„ï¼Œä½† stream å’Œ collections æœ‰ä»¥ä¸‹ä¸åŒï¼š</p><ul><li>æ— å­˜å‚¨ã€‚stream ä¸æ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œå®ƒåªæ˜¯æŸç§æ•°æ®æºçš„ä¸€ä¸ªè§†å›¾ï¼Œæ•°æ®æºå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒJava å®¹å™¨æˆ– I/O channel ç­‰ã€‚</li><li>ä¸ºå‡½æ•°å¼ç¼–ç¨‹è€Œç”Ÿã€‚å¯¹ stream çš„ä»»ä½•ä¿®æ”¹éƒ½ä¸ä¼šä¿®æ”¹èƒŒåçš„æ•°æ®æºï¼Œæ¯”å¦‚å¯¹ stream æ‰§è¡Œè¿‡æ»¤æ“ä½œå¹¶ä¸ä¼šåˆ é™¤è¢«è¿‡æ»¤çš„å…ƒç´ ï¼Œè€Œæ˜¯ä¼šäº§ç”Ÿä¸€ä¸ªä¸åŒ…å«è¢«è¿‡æ»¤å…ƒç´ çš„æ–° streamã€‚</li><li>æƒ°å¼æ‰§è¡Œã€‚stream ä¸Šçš„æ“ä½œå¹¶ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œåªæœ‰ç­‰åˆ°ç”¨æˆ·çœŸæ­£éœ€è¦ç»“æœçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œã€‚</li><li>å¯æ¶ˆè´¹æ€§ã€‚stream åªèƒ½è¢«â€œæ¶ˆè´¹â€ä¸€æ¬¡ï¼Œä¸€æ—¦éå†è¿‡å°±ä¼šå¤±æ•ˆï¼Œå°±åƒå®¹å™¨çš„è¿­ä»£å™¨é‚£æ ·ï¼Œæƒ³è¦å†æ¬¡éå†å¿…é¡»é‡æ–°ç”Ÿæˆã€‚ å¯¹ stream çš„æ“ä½œåˆ†ä¸ºä¸ºä¸¤ç±»ï¼Œä¸­é—´æ“ä½œ(intermediate operations)å’Œç»“æŸæ“ä½œ(terminal operations)ï¼ŒäºŒè€…ç‰¹ç‚¹æ˜¯ï¼š</li></ul><ol><li>ä¸­é—´æ“ä½œæ€»æ˜¯ä¼šæƒ°å¼æ‰§è¡Œï¼Œè°ƒç”¨ä¸­é—´æ“ä½œåªä¼šç”Ÿæˆä¸€ä¸ªæ ‡è®°äº†è¯¥æ“ä½œçš„æ–° streamï¼Œä»…æ­¤è€Œå·²ã€‚</li><li>ç»“æŸæ“ä½œä¼šè§¦å‘å®é™…è®¡ç®—ï¼Œè®¡ç®—å‘ç”Ÿæ—¶ä¼šæŠŠæ‰€æœ‰ä¸­é—´æ“ä½œç§¯æ”’çš„æ“ä½œä»¥ pipeline çš„æ–¹å¼æ‰§è¡Œï¼Œè¿™æ ·å¯ä»¥å‡å°‘è¿­ä»£æ¬¡æ•°ã€‚è®¡ç®—å®Œæˆä¹‹å stream å°±ä¼šå¤±æ•ˆã€‚ å¦‚æœä½ ç†Ÿæ‚‰ Apache Spark RDDï¼Œå¯¹ stream çš„è¿™ä¸ªç‰¹ç‚¹åº”è¯¥ä¸é™Œç”Ÿã€‚</li></ol><p>ä¸‹è¡¨æ±‡æ€»äº† Stream æ¥å£çš„éƒ¨åˆ†å¸¸è§æ–¹æ³•ï¼š</p><table><thead><tr><th style="text-align:left;">æ“ä½œç±»å‹</th><th style="text-align:left;">æ¥å£æ–¹æ³•</th></tr></thead><tbody><tr><td style="text-align:left;">ä¸­é—´æ“ä½œ</td><td style="text-align:left;">concat() distinct() filter() flatMap() limit() map() peek()<br>skip() sorted() parallel() sequential() unordered()</td></tr><tr><td style="text-align:left;">ç»“æŸæ“ä½œ</td><td style="text-align:left;">allMatch() anyMatch() collect() count() findAny() findFirst()<br>forEach() forEachOrdered() max() min() noneMatch() reduce() toArray()</td></tr></tbody></table><p>åŒºåˆ†ä¸­é—´æ“ä½œå’Œç»“æŸæ“ä½œæœ€ç®€å•çš„æ–¹æ³•ï¼Œå°±æ˜¯çœ‹æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿”å›å€¼ä¸º stream çš„å¤§éƒ½æ˜¯ä¸­é—´æ“ä½œï¼Œå¦åˆ™æ˜¯ç»“æŸæ“ä½œã€‚</p><h3 id="stream-æ–¹æ³•ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#stream-æ–¹æ³•ä½¿ç”¨" aria-hidden="true">#</a> stream æ–¹æ³•ä½¿ç”¨</h3><p>stream è·Ÿå‡½æ•°æ¥å£å…³ç³»éå¸¸ç´§å¯†ï¼Œæ²¡æœ‰å‡½æ•°æ¥å£ stream å°±æ— æ³•å·¥ä½œã€‚å›é¡¾ä¸€ä¸‹ï¼šå‡½æ•°æ¥å£æ˜¯æŒ‡å†…éƒ¨åªæœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•çš„æ¥å£ã€‚é€šå¸¸å‡½æ•°æ¥å£å‡ºç°çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼ï¼Œæ‰€ä»¥ä¸å¿…è®°å¿†å‡½æ•°æ¥å£çš„åå­—ã€‚</p><h4 id="foreach-2" tabindex="-1"><a class="header-anchor" href="#foreach-2" aria-hidden="true">#</a> forEach()</h4><p>æˆ‘ä»¬å¯¹ forEach()æ–¹æ³•å¹¶ä¸é™Œç”Ÿï¼Œåœ¨ Collection ä¸­æˆ‘ä»¬å·²ç»è§è¿‡ã€‚æ–¹æ³•ç­¾åä¸º void forEach(Consumer&lt;? super E&gt; action)ï¼Œä½œç”¨æ˜¯å¯¹å®¹å™¨ä¸­çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œ action æŒ‡å®šçš„åŠ¨ä½œï¼Œä¹Ÿå°±æ˜¯å¯¹å…ƒç´ è¿›è¡Œéå†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨Stream.forEach()è¿­ä»£</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç”±äº forEach()æ˜¯ç»“æŸæ–¹æ³•ï¼Œä¸Šè¿°ä»£ç ä¼šç«‹å³æ‰§è¡Œï¼Œè¾“å‡ºæ‰€æœ‰å­—ç¬¦ä¸²ã€‚</p><h4 id="filter" tabindex="-1"><a class="header-anchor" href="#filter" aria-hidden="true">#</a> filter()</h4><figure><img src="/v2/Stream.filter.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‡½æ•°åŸå‹ä¸º<code>Stream&lt;T&gt; filter(Predicate&lt;? super T&gt; predicate)</code>ï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªåªåŒ…å«æ»¡è¶³ predicate æ¡ä»¶å…ƒç´ çš„ Streamã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä¿ç•™é•¿åº¦ç­‰äº3çš„å­—ç¬¦ä¸²</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream<span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç å°†è¾“å‡ºä¸ºé•¿åº¦ç­‰äº 3 çš„å­—ç¬¦ä¸² you å’Œ tooã€‚æ³¨æ„ï¼Œç”±äº filter()æ˜¯ä¸ªä¸­é—´æ“ä½œï¼Œå¦‚æœåªè°ƒç”¨ filter()ä¸ä¼šæœ‰å®é™…è®¡ç®—ï¼Œå› æ­¤ä¹Ÿä¸ä¼šè¾“å‡ºä»»ä½•ä¿¡æ¯ã€‚</p><h4 id="distinct" tabindex="-1"><a class="header-anchor" href="#distinct" aria-hidden="true">#</a> distinct()</h4><figure><img src="/v2/Stream.distinct.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‡½æ•°åŸå‹ä¸º<code>Stream&lt;T&gt; distinct()</code>ï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªå»é™¤é‡å¤å…ƒç´ ä¹‹åçš„ Streamã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream<span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">distinct</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¼šè¾“å‡ºå»æ‰ä¸€ä¸ª too ä¹‹åçš„å…¶ä½™å­—ç¬¦ä¸²ã€‚</p><h4 id="sorted" tabindex="-1"><a class="header-anchor" href="#sorted" aria-hidden="true">#</a> sorted()</h4><p>æ’åºå‡½æ•°æœ‰ä¸¤ä¸ªï¼Œä¸€ä¸ªæ˜¯ç”¨è‡ªç„¶é¡ºåºæ’åºï¼Œä¸€ä¸ªæ˜¯ä½¿ç”¨è‡ªå®šä¹‰æ¯”è¾ƒå™¨æ’åºï¼Œå‡½æ•°åŸå‹åˆ†åˆ«ä¸º<code>Stream&lt;T&gt;ã€€sorted()å’ŒStream&lt;T&gt;ã€€sorted(Comparator&lt;? super T&gt; comparator)</code>ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream<span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">sorted</span><span class="token punctuation">(</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> str1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>str2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç å°†è¾“å‡ºæŒ‰ç…§é•¿åº¦å‡åºæ’åºåçš„å­—ç¬¦ä¸²ï¼Œç»“æœå®Œå…¨åœ¨é¢„æ–™ä¹‹ä¸­ã€‚</p><h4 id="map" tabindex="-1"><a class="header-anchor" href="#map" aria-hidden="true">#</a> map()</h4><figure><img src="/v2/Stream.map.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‡½æ•°åŸå‹ä¸º<code>&lt;R&gt; Stream&lt;R&gt; map(Function&lt;? super T,? extends R&gt; mapper)</code>ï¼Œä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªå¯¹å½“å‰æ‰€æœ‰å…ƒç´ æ‰§è¡Œæ‰§è¡Œ mapper ä¹‹åçš„ç»“æœç»„æˆçš„ Streamã€‚ç›´è§‚çš„è¯´ï¼Œå°±æ˜¯å¯¹æ¯ä¸ªå…ƒç´ æŒ‰ç…§æŸç§æ“ä½œè¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢å‰å Stream ä¸­å…ƒç´ çš„ä¸ªæ•°ä¸ä¼šæ”¹å˜ï¼Œä½†å…ƒç´ çš„ç±»å‹å–å†³äºè½¬æ¢ä¹‹åçš„ç±»å‹ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> streamã€€<span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> str<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>str <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç å°†è¾“å‡ºåŸå­—ç¬¦ä¸²çš„å¤§å†™å½¢å¼ã€‚</p><h4 id="flatmap" tabindex="-1"><a class="header-anchor" href="#flatmap" aria-hidden="true">#</a> flatMap()</h4><figure><img src="/v2/Stream.flatMap.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å‡½æ•°åŸå‹ä¸º<code>&lt;R&gt; Stream&lt;R&gt; flatMap(Function&lt;? super T,? extends Stream&lt;? extends R&gt;&gt; mapper)</code>ï¼Œä½œç”¨æ˜¯å¯¹æ¯ä¸ªå…ƒç´ æ‰§è¡Œ mapper æŒ‡å®šçš„æ“ä½œï¼Œå¹¶ç”¨æ‰€æœ‰ mapper è¿”å›çš„ Stream ä¸­çš„å…ƒç´ ç»„æˆä¸€ä¸ªæ–°çš„ Stream ä½œä¸ºæœ€ç»ˆè¿”å›ç»“æœã€‚è¯´èµ·æ¥å¤ªæ‹—å£ï¼Œé€šä¿—çš„è®² flatMap()çš„ä½œç”¨å°±ç›¸å½“äºæŠŠåŸ stream ä¸­çš„æ‰€æœ‰å…ƒç´ éƒ½â€æ‘Šå¹³â€ä¹‹åç»„æˆçš„ Streamï¼Œè½¬æ¢å‰åå…ƒç´ çš„ä¸ªæ•°å’Œç±»å‹éƒ½å¯èƒ½ä¼šæ”¹å˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Integer</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>list <span class="token operator">-&gt;</span> list<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>i <span class="token operator">-&gt;</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¸­ï¼ŒåŸæ¥çš„ stream ä¸­æœ‰ä¸¤ä¸ªå…ƒç´ ï¼Œåˆ†åˆ«æ˜¯ä¸¤ä¸ª List<code>&lt;Integer&gt;</code>ï¼Œæ‰§è¡Œ flatMap()ä¹‹åï¼Œå°†æ¯ä¸ª List éƒ½â€œæ‘Šå¹³â€æˆäº†ä¸€ä¸ªä¸ªçš„æ•°å­—ï¼Œæ‰€ä»¥ä¼šæ–°äº§ç”Ÿä¸€ä¸ªç”± 5 ä¸ªæ•°å­—ç»„æˆçš„ Streamã€‚æ‰€ä»¥æœ€ç»ˆå°†è¾“å‡º 1~5 è¿™ 5 ä¸ªæ•°å­—ã€‚ æˆªæ­¢åˆ°ç›®å‰æˆ‘ä»¬æ„Ÿè§‰è‰¯å¥½ï¼Œå·²ä»‹ç» Stream æ¥å£å‡½æ•°ç†è§£èµ·æ¥å¹¶ä¸è´¹åŠ²å„¿ã€‚å¦‚æœä½ å°±æ­¤ä»¥ä¸ºå‡½æ•°å¼ç¼–ç¨‹ä¸è¿‡å¦‚æ­¤ï¼Œææ€•æ˜¯é«˜å…´åœ°å¤ªæ—©äº†ã€‚ä¸‹ä¸€èŠ‚å¯¹ Stream è§„çº¦æ“ä½œçš„ä»‹ç»å°†åˆ·æ–°ä½ ç°åœ¨çš„è®¤è¯†ã€‚</p><h2 id="streams-api-ii" tabindex="-1"><a class="header-anchor" href="#streams-api-ii" aria-hidden="true">#</a> Streams API(II)</h2><p>ä¸Šä¸€èŠ‚ä»‹ç»äº†éƒ¨åˆ† Stream å¸¸è§æ¥å£æ–¹æ³•ï¼Œç†è§£èµ·æ¥å¹¶ä¸å›°éš¾ï¼Œä½† Stream çš„ç”¨æ³•ä¸æ­¢äºæ­¤ï¼Œæœ¬èŠ‚æˆ‘ä»¬å°†ä»ç„¶ä»¥ Stream ä¸ºä¾‹ï¼Œä»‹ç»æµçš„è§„çº¦æ“ä½œã€‚</p><p>è§„çº¦æ“ä½œï¼ˆreduction operationï¼‰åˆè¢«ç§°ä½œæŠ˜å æ“ä½œï¼ˆfoldï¼‰ï¼Œæ˜¯é€šè¿‡æŸä¸ªè¿æ¥åŠ¨ä½œå°†æ‰€æœ‰å…ƒç´ æ±‡æ€»æˆä¸€ä¸ªæ±‡æ€»ç»“æœçš„è¿‡ç¨‹ã€‚å…ƒç´ æ±‚å’Œã€æ±‚æœ€å¤§å€¼æˆ–æœ€å°å€¼ã€æ±‚å‡ºå…ƒç´ æ€»ä¸ªæ•°ã€å°†æ‰€æœ‰å…ƒç´ è½¬æ¢æˆä¸€ä¸ªåˆ—è¡¨æˆ–é›†åˆï¼Œéƒ½å±äºè§„çº¦æ“ä½œã€‚Stream ç±»åº“æœ‰ä¸¤ä¸ªé€šç”¨çš„è§„çº¦æ“ä½œ reduce()å’Œ collect()ï¼Œä¹Ÿæœ‰ä¸€äº›ä¸ºç®€åŒ–ä¹¦å†™è€Œè®¾è®¡çš„ä¸“ç”¨è§„çº¦æ“ä½œï¼Œæ¯”å¦‚ sum()ã€max()ã€min()ã€count()ç­‰ã€‚</p><p>æœ€å¤§æˆ–æœ€å°å€¼è¿™ç±»è§„çº¦æ“ä½œå¾ˆå¥½ç†è§£ï¼ˆè‡³å°‘æ–¹æ³•è¯­ä¹‰ä¸Šæ˜¯è¿™æ ·ï¼‰ï¼Œæˆ‘ä»¬ç€é‡ä»‹ç» reduce()å’Œ collect()ï¼Œè¿™æ˜¯æ¯”è¾ƒæœ‰é­”æ³•çš„åœ°æ–¹ã€‚</p><h3 id="å¤šé¢æ‰‹-reduce" tabindex="-1"><a class="header-anchor" href="#å¤šé¢æ‰‹-reduce" aria-hidden="true">#</a> å¤šé¢æ‰‹ reduce()</h3><p>reduce æ“ä½œå¯ä»¥å®ç°ä»ä¸€ç»„å…ƒç´ ä¸­ç”Ÿæˆä¸€ä¸ªå€¼ï¼Œsum()ã€max()ã€min()ã€count()ç­‰éƒ½æ˜¯ reduce æ“ä½œï¼Œå°†ä»–ä»¬å•ç‹¬è®¾ä¸ºå‡½æ•°åªæ˜¯å› ä¸ºå¸¸ç”¨ã€‚reduce()çš„æ–¹æ³•å®šä¹‰æœ‰ä¸‰ç§é‡å†™å½¢å¼ï¼š</p><ul><li><code>Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator)</code></li><li><code>T reduce(T identity, BinaryOperator&lt;T&gt; accumulator)</code></li><li><code>&lt;U&gt; U reduce(U identity, BiFunction&lt;U,? super T,U&gt; accumulator, BinaryOperator&lt;U&gt; combiner)</code></li></ul><p>è™½ç„¶å‡½æ•°å®šä¹‰è¶Šæ¥è¶Šé•¿ï¼Œä½†è¯­ä¹‰ä¸æ›¾æ”¹å˜ï¼Œå¤šçš„å‚æ•°åªæ˜¯ä¸ºäº†æŒ‡æ˜åˆå§‹å€¼ï¼ˆå‚æ•° identityï¼‰ï¼Œæˆ–è€…æ˜¯æŒ‡å®šå¹¶è¡Œæ‰§è¡Œæ—¶å¤šä¸ªéƒ¨åˆ†ç»“æœçš„åˆå¹¶æ–¹å¼ï¼ˆå‚æ•° combinerï¼‰ã€‚reduce()æœ€å¸¸ç”¨çš„åœºæ™¯å°±æ˜¯ä»ä¸€å †å€¼ä¸­ç”Ÿæˆä¸€ä¸ªå€¼ã€‚ç”¨è¿™ä¹ˆå¤æ‚çš„å‡½æ•°å»æ±‚ä¸€ä¸ªæœ€å¤§æˆ–æœ€å°å€¼ï¼Œä½ æ˜¯ä¸æ˜¯è§‰å¾—è®¾è®¡è€…æœ‰ç—…ã€‚å…¶å®ä¸ç„¶ï¼Œå› ä¸ºâ€œå¤§â€å’Œâ€œå°â€æˆ–è€…â€œæ±‚å’Œâ€æœ‰æ—¶ä¼šæœ‰ä¸åŒçš„è¯­ä¹‰ã€‚</p><p>éœ€æ±‚ï¼šä»ä¸€ç»„å•è¯ä¸­æ‰¾å‡ºæœ€é•¿çš„å•è¯ã€‚è¿™é‡Œâ€œå¤§â€çš„å«ä¹‰å°±æ˜¯â€œé•¿â€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ‰¾å‡ºæœ€é•¿çš„å•è¯</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Optional</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> longest <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>s1<span class="token punctuation">,</span> s2<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> s1<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;=</span>s2<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> s1 <span class="token operator">:</span> s2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Optional&lt;String&gt; longest = stream.max((s1, s2) -&gt; s1.length()-s2.length());</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>longest<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç ä¼šé€‰å‡ºæœ€é•¿çš„å•è¯ loveï¼Œå…¶ä¸­ Optional æ˜¯ï¼ˆä¸€ä¸ªï¼‰å€¼çš„å®¹å™¨ï¼Œä½¿ç”¨å®ƒå¯ä»¥é¿å… null å€¼çš„éº»çƒ¦ã€‚å½“ç„¶å¯ä»¥ä½¿ç”¨ Stream.max(Comparator&lt;? super T&gt; comparator)æ–¹æ³•æ¥è¾¾åˆ°åŒç­‰æ•ˆæœï¼Œä½† reduce()è‡ªæœ‰å…¶å­˜åœ¨çš„ç†ç”±ã€‚</p><figure><img src="/v2/Stream.reduce_parameter.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>éœ€æ±‚ï¼šæ±‚å‡ºä¸€ç»„å•è¯çš„é•¿åº¦ä¹‹å’Œã€‚è¿™æ˜¯ä¸ªâ€œæ±‚å’Œâ€æ“ä½œï¼Œæ“ä½œå¯¹è±¡è¾“å…¥ç±»å‹æ˜¯ Stringï¼Œè€Œç»“æœç±»å‹æ˜¯ Integerã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æ±‚å•è¯é•¿åº¦ä¹‹å’Œ</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Integer</span> lengthSum <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>ã€€<span class="token comment">// åˆå§‹å€¼ã€€// (1)</span>
        <span class="token punctuation">(</span>sum<span class="token punctuation">,</span> str<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> sum<span class="token operator">+</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// ç´¯åŠ å™¨ // (2)</span>
        <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> a<span class="token operator">+</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>ã€€<span class="token comment">// éƒ¨åˆ†å’Œæ‹¼æ¥å™¨ï¼Œå¹¶è¡Œæ‰§è¡Œæ—¶æ‰ä¼šç”¨åˆ° // (3)</span>
<span class="token comment">// int lengthSum = stream.mapToInt(str -&gt; str.length()).sum();</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>lengthSum<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æ ‡å·(2)å¤„å°† i. å­—ç¬¦ä¸²æ˜ å°„æˆé•¿åº¦ï¼Œii. å¹¶å’Œå½“å‰ç´¯åŠ å’Œç›¸åŠ ã€‚è¿™æ˜¾ç„¶æ˜¯ä¸¤æ­¥æ“ä½œï¼Œä½¿ç”¨ reduce()å‡½æ•°å°†è¿™ä¸¤æ­¥åˆäºŒä¸ºä¸€ï¼Œæ›´æœ‰åŠ©äºæå‡æ€§èƒ½ã€‚å¦‚æœæƒ³è¦ä½¿ç”¨ map()å’Œ sum()ç»„åˆæ¥è¾¾åˆ°ä¸Šè¿°ç›®çš„ï¼Œä¹Ÿæ˜¯å¯ä»¥çš„ã€‚</p><p>reduce()æ“…é•¿çš„æ˜¯ç”Ÿæˆä¸€ä¸ªå€¼ï¼Œå¦‚æœæƒ³è¦ä» Stream ç”Ÿæˆä¸€ä¸ªé›†åˆæˆ–è€… Map ç­‰å¤æ‚çš„å¯¹è±¡è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿç»ˆææ­¦å™¨ collect()æ¨ªç©ºå‡ºä¸–ï¼</p><h3 id="ç»ˆææ­¦å™¨-collect" tabindex="-1"><a class="header-anchor" href="#ç»ˆææ­¦å™¨-collect" aria-hidden="true">#</a> ç»ˆææ­¦å™¨ collect()</h3><p>ä¸å¤¸å¼ çš„è®²ï¼Œå¦‚æœä½ å‘ç°æŸä¸ªåŠŸèƒ½åœ¨ Stream æ¥å£ä¸­æ²¡æ‰¾åˆ°ï¼Œåæœ‰å…«ä¹å¯ä»¥é€šè¿‡ collect()æ–¹æ³•å®ç°ã€‚collect()æ˜¯ Stream æ¥å£æ–¹æ³•ä¸­æœ€çµæ´»çš„ä¸€ä¸ªï¼Œå­¦ä¼šå®ƒæ‰ç®—çœŸæ­£å…¥é—¨ Java å‡½æ•°å¼ç¼–ç¨‹ã€‚å…ˆçœ‹å‡ ä¸ªçƒ­èº«çš„å°ä¾‹å­ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å°†Streamè½¬æ¢æˆå®¹å™¨æˆ–Map</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span>
<span class="token comment">// Set&lt;String&gt; set = stream.collect(Collectors.toSet()); // (2)</span>
<span class="token comment">// Map&lt;String, Integer&gt; map = stream.collect(Collectors.toMap(Function.identity(), String::length)); // (3)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç åˆ†åˆ«åˆ—ä¸¾äº†å¦‚ä½•å°† Stream è½¬æ¢æˆ Listã€Set å’Œ Mapã€‚è™½ç„¶ä»£ç è¯­ä¹‰å¾ˆæ˜ç¡®ï¼Œå¯æ˜¯æˆ‘ä»¬ä»ç„¶ä¼šæœ‰å‡ ä¸ªç–‘é—®ï¼š</p><ol><li>Function.identity()æ˜¯å¹²ä»€ä¹ˆçš„ï¼Ÿ</li><li>String::length æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ</li><li>Collectors æ˜¯ä¸ªä»€ä¹ˆä¸œè¥¿ï¼Ÿ</li></ol><h3 id="æ¥å£çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#æ¥å£çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•" aria-hidden="true">#</a> æ¥å£çš„é™æ€æ–¹æ³•å’Œé»˜è®¤æ–¹æ³•</h3><p>Function æ˜¯ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆ Function.identity()æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™è¦ä»ä¸¤æ–¹é¢è§£é‡Šï¼š</p><ol><li>Java 8 å…è®¸åœ¨æ¥å£ä¸­åŠ å…¥å…·ä½“æ–¹æ³•ã€‚æ¥å£ä¸­çš„å…·ä½“æ–¹æ³•æœ‰ä¸¤ç§ï¼Œdefault æ–¹æ³•å’Œ static æ–¹æ³•ï¼Œidentity()å°±æ˜¯ Function æ¥å£çš„ä¸€ä¸ªé™æ€æ–¹æ³•ã€‚</li><li>Function.identity()è¿”å›ä¸€ä¸ªè¾“å‡ºè·Ÿè¾“å…¥ä¸€æ ·çš„ Lambda è¡¨è¾¾å¼å¯¹è±¡ï¼Œç­‰ä»·äºå½¢å¦‚ t -&gt; t å½¢å¼çš„ Lambda è¡¨è¾¾å¼ã€‚</li></ol><p>ä¸Šé¢çš„è§£é‡Šæ˜¯ä¸æ˜¯è®©ä½ ç–‘é—®æ›´å¤šï¼Ÿä¸è¦é—®æˆ‘ä¸ºä»€ä¹ˆæ¥å£ä¸­å¯ä»¥æœ‰å…·ä½“æ–¹æ³•ï¼Œä¹Ÿä¸è¦å‘Šè¯‰æˆ‘ä½ è§‰å¾— t -&gt; t æ¯” identity()æ–¹æ³•æ›´ç›´è§‚ã€‚æˆ‘ä¼šå‘Šè¯‰ä½ æ¥å£ä¸­çš„ default æ–¹æ³•æ˜¯ä¸€ä¸ªæ— å¥ˆä¹‹ä¸¾ï¼Œåœ¨ Java 7 åŠä¹‹å‰è¦æƒ³åœ¨å®šä¹‰å¥½çš„æ¥å£ä¸­åŠ å…¥æ–°çš„æŠ½è±¡æ–¹æ³•æ˜¯å¾ˆå›°éš¾ç”šè‡³ä¸å¯èƒ½çš„ï¼Œå› ä¸ºæ‰€æœ‰å®ç°äº†è¯¥æ¥å£çš„ç±»éƒ½è¦é‡æ–°å®ç°ã€‚è¯•æƒ³åœ¨ Collection æ¥å£ä¸­åŠ å…¥ä¸€ä¸ª stream()æŠ½è±¡æ–¹æ³•ä¼šæ€æ ·ï¼Ÿdefault æ–¹æ³•å°±æ˜¯ç”¨æ¥è§£å†³è¿™ä¸ªå°´å°¬é—®é¢˜çš„ï¼Œç›´æ¥åœ¨æ¥å£ä¸­å®ç°æ–°åŠ å…¥çš„æ–¹æ³•ã€‚æ—¢ç„¶å·²ç»å¼•å…¥äº† default æ–¹æ³•ï¼Œä¸ºä½•ä¸å†åŠ å…¥ static æ–¹æ³•æ¥é¿å…ä¸“é—¨çš„å·¥å…·ç±»å‘¢ï¼</p><h3 id="æ–¹æ³•å¼•ç”¨-1" tabindex="-1"><a class="header-anchor" href="#æ–¹æ³•å¼•ç”¨-1" aria-hidden="true">#</a> æ–¹æ³•å¼•ç”¨</h3><p>è¯¸å¦‚ String::length çš„è¯­æ³•å½¢å¼å«åšæ–¹æ³•å¼•ç”¨ï¼ˆmethod referencesï¼‰ï¼Œè¿™ç§è¯­æ³•ç”¨æ¥æ›¿ä»£æŸäº›ç‰¹å®šå½¢å¼ Lambda è¡¨è¾¾å¼ã€‚å¦‚æœ Lambda è¡¨è¾¾å¼çš„å…¨éƒ¨å†…å®¹å°±æ˜¯è°ƒç”¨ä¸€ä¸ªå·²æœ‰çš„æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥ç”¨æ–¹æ³•å¼•ç”¨æ¥æ›¿ä»£ Lambda è¡¨è¾¾å¼ã€‚æ–¹æ³•å¼•ç”¨å¯ä»¥ç»†åˆ†ä¸ºå››ç±»ï¼š</p><table><thead><tr><th style="text-align:left;">æ–¹æ³•å¼•ç”¨ç±»åˆ«</th><th style="text-align:left;">ä¸¾ä¾‹</th></tr></thead><tbody><tr><td style="text-align:left;">å¼•ç”¨é™æ€æ–¹æ³•</td><td style="text-align:left;">Integer::sum</td></tr><tr><td style="text-align:left;">å¼•ç”¨æŸä¸ªå¯¹è±¡çš„æ–¹æ³•</td><td style="text-align:left;">list::add</td></tr><tr><td style="text-align:left;">å¼•ç”¨æŸä¸ªç±»çš„æ–¹æ³•</td><td style="text-align:left;">String::length</td></tr><tr><td style="text-align:left;">å¼•ç”¨æ„é€ æ–¹æ³•</td><td style="text-align:left;">HashMap::new</td></tr></tbody></table><p>æˆ‘ä»¬ä¼šåœ¨åé¢çš„ä¾‹å­ä¸­ä½¿ç”¨æ–¹æ³•å¼•ç”¨ã€‚</p><h3 id="æ”¶é›†å™¨" tabindex="-1"><a class="header-anchor" href="#æ”¶é›†å™¨" aria-hidden="true">#</a> æ”¶é›†å™¨</h3><p>ç›¸ä¿¡å‰é¢ç¹ççš„å†…å®¹å·²å½»åº•æ‰“æ¶ˆäº†ä½ å­¦ä¹  Java å‡½æ•°å¼ç¼–ç¨‹çš„çƒ­æƒ…ï¼Œä¸è¿‡å¾ˆé—æ†¾ï¼Œä¸‹é¢çš„å†…å®¹æ›´ç¹çã€‚ä½†è¿™ä¸èƒ½æ€ª Stream ç±»åº“ï¼Œå› ä¸ºè¦å®ç°çš„åŠŸèƒ½æœ¬èº«å¾ˆå¤æ‚ã€‚</p><figure><img src="/v2/Stream.collect_parameter.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ”¶é›†å™¨ï¼ˆCollectorï¼‰æ˜¯ä¸º Stream.collect()æ–¹æ³•é‡èº«æ‰“é€ çš„å·¥å…·æ¥å£ï¼ˆç±»ï¼‰ã€‚è€ƒè™‘ä¸€ä¸‹å°†ä¸€ä¸ª Stream è½¬æ¢æˆä¸€ä¸ªå®¹å™¨ï¼ˆæˆ–è€… Mapï¼‰éœ€è¦åšå“ªäº›å·¥ä½œï¼Ÿæˆ‘ä»¬è‡³å°‘éœ€è¦ä¸¤æ ·ä¸œè¥¿ï¼š</p><ol><li>ç›®æ ‡å®¹å™¨æ˜¯ä»€ä¹ˆï¼Ÿæ˜¯ ArrayList è¿˜æ˜¯ HashSetï¼Œæˆ–è€…æ˜¯ä¸ª TreeMapã€‚</li><li>æ–°å…ƒç´ å¦‚ä½•æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Ÿæ˜¯ List.add()è¿˜æ˜¯ Map.put()ã€‚</li></ol><p>å¦‚æœå¹¶è¡Œçš„è¿›è¡Œè§„çº¦ï¼Œè¿˜éœ€è¦å‘Šè¯‰ collect() 3. å¤šä¸ªéƒ¨åˆ†ç»“æœå¦‚ä½•åˆå¹¶æˆä¸€ä¸ªã€‚</p><p>ç»“åˆä»¥ä¸Šåˆ†æï¼Œcollect()æ–¹æ³•å®šä¹‰ä¸º<code>&lt;R&gt; R collect(Supplier&lt;R&gt; supplier, BiConsumer&lt;R,? super T&gt; accumulator, BiConsumer&lt;R,R&gt; combiner)</code>ï¼Œä¸‰ä¸ªå‚æ•°ä¾æ¬¡å¯¹åº”ä¸Šè¿°ä¸‰æ¡åˆ†æã€‚ä¸è¿‡æ¯æ¬¡è°ƒç”¨ collect()éƒ½è¦ä¼ å…¥è¿™ä¸‰ä¸ªå‚æ•°å¤ªéº»çƒ¦ï¼Œæ”¶é›†å™¨ Collector å°±æ˜¯å¯¹è¿™ä¸‰ä¸ªå‚æ•°çš„ç®€å•å°è£…,æ‰€ä»¥ collect()çš„å¦ä¸€å®šä¹‰ä¸º<code>&lt;R,A&gt; R collect(Collector&lt;? super T,A,R&gt; collector)</code>ã€‚Collectors å·¥å…·ç±»å¯é€šè¿‡é™æ€æ–¹æ³•ç”Ÿæˆå„ç§å¸¸ç”¨çš„ Collectorã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœè¦å°† Stream è§„çº¦æˆ List å¯ä»¥é€šè¿‡å¦‚ä¸‹ä¸¤ç§æ–¹å¼å®ç°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">//ã€€å°†Streamè§„çº¦æˆList</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token function">add</span><span class="token punctuation">,</span> <span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token function">addAll</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ–¹å¼ï¼‘</span>
<span class="token comment">//List&lt;String&gt; list = stream.collect(Collectors.toList());// æ–¹å¼2</span>
<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨æŒ‡å®š collect()çš„ä¸‰ä¸ªå‚æ•°ï¼Œè€Œæ˜¯è°ƒç”¨ collect(Collector&lt;? super T,A,R&gt; collector)æ–¹æ³•ï¼Œå¹¶ä¸”å‚æ•°ä¸­çš„ Collector å¯¹è±¡å¤§éƒ½æ˜¯ç›´æ¥é€šè¿‡ Collectors å·¥å…·ç±»è·å¾—ã€‚å®é™…ä¸Šä¼ å…¥çš„æ”¶é›†å™¨çš„è¡Œä¸ºå†³å®šäº† collect()çš„è¡Œä¸ºã€‚</p><h3 id="ä½¿ç”¨-collect-ç”Ÿæˆ-collection" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-collect-ç”Ÿæˆ-collection" aria-hidden="true">#</a> ä½¿ç”¨ collect()ç”Ÿæˆ Collection</h3><p>å‰é¢å·²ç»æåˆ°é€šè¿‡ collect()æ–¹æ³•å°† Stream è½¬æ¢æˆå®¹å™¨çš„æ–¹æ³•ï¼Œè¿™é‡Œå†æ±‡æ€»ä¸€ä¸‹ã€‚å°† Stream è½¬æ¢æˆ List æˆ– Set æ˜¯æ¯”è¾ƒå¸¸è§çš„æ“ä½œï¼Œæ‰€ä»¥ Collectors å·¥å…·å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹åº”çš„æ”¶é›†å™¨ï¼Œé€šè¿‡å¦‚ä¸‹ä»£ç å³å¯å®Œæˆï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// å°†Streamè½¬æ¢æˆListæˆ–Set</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;too&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (1)</span>
<span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> set <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// (2)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç èƒ½å¤Ÿæ»¡è¶³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†ç”±äºè¿”å›ç»“æœæ˜¯æ¥å£ç±»å‹ï¼Œæˆ‘ä»¬å¹¶ä¸çŸ¥é“ç±»åº“å®é™…é€‰æ‹©çš„å®¹å™¨ç±»å‹æ˜¯ä»€ä¹ˆï¼Œæœ‰æ—¶å€™æˆ‘ä»¬å¯èƒ½ä¼šæƒ³è¦äººä¸ºæŒ‡å®šå®¹å™¨çš„å®é™…ç±»å‹ï¼Œè¿™ä¸ªéœ€æ±‚å¯é€šè¿‡<code>Collectors.toCollection(Supplier&lt;C&gt; collectionFactory)</code>æ–¹æ³•å®Œæˆã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨toCollection()æŒ‡å®šè§„çº¦å®¹å™¨çš„ç±»å‹</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> arrayList <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">ArrayList</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// (3)</span>
<span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> hashSet <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toCollection</span><span class="token punctuation">(</span><span class="token class-name">HashSet</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// (4)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç (3)å¤„æŒ‡å®šè§„çº¦ç»“æœæ˜¯ ArrayListï¼Œè€Œ(4)å¤„æŒ‡å®šè§„çº¦ç»“æœä¸º HashSetã€‚ä¸€åˆ‡å¦‚ä½ æ‰€æ„¿ã€‚</p><h3 id="ä½¿ç”¨-collect-ç”Ÿæˆ-map" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-collect-ç”Ÿæˆ-map" aria-hidden="true">#</a> ä½¿ç”¨ collect()ç”Ÿæˆ Map</h3><p>å‰é¢å·²ç»è¯´è¿‡ Stream èƒŒåä¾èµ–äºæŸç§æ•°æ®æºï¼Œæ•°æ®æºå¯ä»¥æ˜¯æ•°ç»„ã€å®¹å™¨ç­‰ï¼Œä½†ä¸èƒ½æ˜¯ Mapã€‚åè¿‡æ¥ä» Stream ç”Ÿæˆ Map æ˜¯å¯ä»¥çš„ï¼Œä½†æˆ‘ä»¬è¦æƒ³æ¸…æ¥š Map çš„ key å’Œ value åˆ†åˆ«ä»£è¡¨ä»€ä¹ˆï¼Œæ ¹æœ¬åŸå› æ˜¯æˆ‘ä»¬è¦æƒ³æ¸…æ¥šè¦å¹²ä»€ä¹ˆã€‚é€šå¸¸åœ¨ä¸‰ç§æƒ…å†µä¸‹ collect()çš„ç»“æœä¼šæ˜¯ Mapï¼š</p><ol><li>ä½¿ç”¨ Collectors.toMap()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œç”¨æˆ·éœ€è¦æŒ‡å®šå¦‚ä½•ç”Ÿæˆ Map çš„ key å’Œ valueã€‚</li><li>ä½¿ç”¨ Collectors.partitioningBy()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œå¯¹å…ƒç´ è¿›è¡ŒäºŒåˆ†åŒºæ“ä½œæ—¶ç”¨åˆ°ã€‚</li><li>ä½¿ç”¨ Collectors.groupingBy()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œå¯¹å…ƒç´ åš group æ“ä½œæ—¶ç”¨åˆ°ã€‚</li></ol><p>æƒ…å†µ 1ï¼šä½¿ç”¨ toMap()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œè¿™ç§æƒ…å†µæ˜¯æœ€ç›´æ¥çš„ï¼Œå‰é¢ä¾‹å­ä¸­å·²æåˆ°ï¼Œè¿™æ˜¯å’Œ Collectors.toCollection()å¹¶åˆ—çš„æ–¹æ³•ã€‚å¦‚ä¸‹ä»£ç å±•ç¤ºå°†å­¦ç”Ÿåˆ—è¡¨è½¬æ¢æˆç”±&lt;å­¦ç”Ÿï¼ŒGPA&gt;ç»„æˆçš„ Mapã€‚éå¸¸ç›´è§‚ï¼Œæ— éœ€å¤šè¨€ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨toMap()ç»Ÿè®¡å­¦ç”ŸGPA</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">,</span> <span class="token class-name">Double</span><span class="token punctuation">&gt;</span></span> studentToGPA <span class="token operator">=</span>
     students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toMap</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token punctuation">.</span><span class="token function">identity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">// å¦‚ä½•ç”Ÿæˆkey</span>
                                     student <span class="token operator">-&gt;</span> <span class="token function">computeGPA</span><span class="token punctuation">(</span>student<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å¦‚ä½•ç”Ÿæˆvalue</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æƒ…å†µ 2ï¼šä½¿ç”¨ partitioningBy()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œè¿™ç§æƒ…å†µé€‚ç”¨äºå°† Stream ä¸­çš„å…ƒç´ ä¾æ®æŸä¸ªäºŒå€¼é€»è¾‘ï¼ˆæ»¡è¶³æ¡ä»¶ï¼Œæˆ–ä¸æ»¡è¶³ï¼‰åˆ†æˆäº’è¡¥ç›¸äº¤çš„ä¸¤éƒ¨åˆ†ï¼Œæ¯”å¦‚ç”·å¥³æ€§åˆ«ã€æˆç»©åŠæ ¼ä¸å¦ç­‰ã€‚ä¸‹åˆ—ä»£ç å±•ç¤ºå°†å­¦ç”Ÿåˆ†æˆæˆç»©åŠæ ¼æˆ–ä¸åŠæ ¼çš„ä¸¤éƒ¨åˆ†ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Partition students into passing and failing</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Boolean</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Student</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> passingFailing <span class="token operator">=</span> students<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">partitioningBy</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">getGrade</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token constant">PASS_THRESHOLD</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æƒ…å†µ 3ï¼šä½¿ç”¨ groupingBy()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œè¿™æ˜¯æ¯”è¾ƒçµæ´»çš„ä¸€ç§æƒ…å†µã€‚è·Ÿ SQL ä¸­çš„ group by è¯­å¥ç±»ä¼¼ï¼Œè¿™é‡Œçš„ groupingBy()ä¹Ÿæ˜¯æŒ‰ç…§æŸä¸ªå±æ€§å¯¹æ•°æ®è¿›è¡Œåˆ†ç»„ï¼Œå±æ€§ç›¸åŒçš„å…ƒç´ ä¼šè¢«å¯¹åº”åˆ° Map çš„åŒä¸€ä¸ª key ä¸Šã€‚ä¸‹åˆ—ä»£ç å±•ç¤ºå°†å‘˜å·¥æŒ‰ç…§éƒ¨é—¨è¿›è¡Œåˆ†ç»„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Group employees by department</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">Employee</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> byDept <span class="token operator">=</span> employees<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token operator">::</span><span class="token function">getDepartment</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»¥ä¸Šåªæ˜¯åˆ†ç»„çš„æœ€åŸºæœ¬ç”¨æ³•ï¼Œæœ‰äº›æ—¶å€™ä»…ä»…åˆ†ç»„æ˜¯ä¸å¤Ÿçš„ã€‚åœ¨ SQL ä¸­ä½¿ç”¨ group by æ˜¯ä¸ºäº†ååŠ©å…¶ä»–æŸ¥è¯¢ï¼Œæ¯”å¦‚ 1. å…ˆå°†å‘˜å·¥æŒ‰ç…§éƒ¨é—¨åˆ†ç»„ï¼Œ2. ç„¶åç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨å‘˜å·¥çš„äººæ•°ã€‚Java ç±»åº“è®¾è®¡è€…ä¹Ÿè€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œå¢å¼ºç‰ˆçš„ groupingBy()èƒ½å¤Ÿæ»¡è¶³è¿™ç§éœ€æ±‚ã€‚å¢å¼ºç‰ˆçš„ groupingBy()å…è®¸æˆ‘ä»¬å¯¹å…ƒç´ åˆ†ç»„ä¹‹åå†æ‰§è¡ŒæŸç§è¿ç®—ï¼Œæ¯”å¦‚æ±‚å’Œã€è®¡æ•°ã€å¹³å‡å€¼ã€ç±»å‹è½¬æ¢ç­‰ã€‚è¿™ç§å…ˆå°†å…ƒç´ åˆ†ç»„çš„æ”¶é›†å™¨å«åšä¸Šæ¸¸æ”¶é›†å™¨ï¼Œä¹‹åæ‰§è¡Œå…¶ä»–è¿ç®—çš„æ”¶é›†å™¨å«åšä¸‹æ¸¸æ”¶é›†å™¨(downstream Collector)ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨ä¸‹æ¸¸æ”¶é›†å™¨ç»Ÿè®¡æ¯ä¸ªéƒ¨é—¨çš„äººæ•°</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">,</span> <span class="token class-name">Integer</span><span class="token punctuation">&gt;</span></span> totalByDept <span class="token operator">=</span> employees<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                    <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token operator">::</span><span class="token function">getDepartment</span><span class="token punctuation">,</span>
                                                   <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">counting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// ä¸‹æ¸¸æ”¶é›†å™¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šé¢ä»£ç çš„é€»è¾‘æ˜¯ä¸æ˜¯è¶Šçœ‹è¶Šåƒ SQLï¼Ÿé«˜åº¦éç»“æ„åŒ–ã€‚è¿˜æœ‰æ›´ç‹ çš„ï¼Œä¸‹æ¸¸æ”¶é›†å™¨è¿˜å¯ä»¥åŒ…å«æ›´ä¸‹æ¸¸çš„æ”¶é›†å™¨ï¼Œè¿™ç»ä¸æ˜¯ä¸ºäº†ç‚«æŠ€è€Œå¢åŠ çš„æŠŠæˆï¼Œè€Œæ˜¯å®é™…åœºæ™¯éœ€è¦ã€‚è€ƒè™‘å°†å‘˜å·¥æŒ‰ç…§éƒ¨é—¨åˆ†ç»„çš„åœºæ™¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å¾—åˆ°æ¯ä¸ªå‘˜å·¥çš„åå­—ï¼ˆå­—ç¬¦ä¸²ï¼‰ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªä¸ª Employee å¯¹è±¡ï¼Œå¯é€šè¿‡å¦‚ä¸‹æ–¹å¼åšåˆ°ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// æŒ‰ç…§éƒ¨é—¨å¯¹å‘˜å·¥åˆ†å¸ƒç»„ï¼Œå¹¶åªä¿ç•™å‘˜å·¥çš„åå­—</span>
<span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Department</span><span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> byDept <span class="token operator">=</span> employees<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">groupingBy</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token operator">::</span><span class="token function">getDepartment</span><span class="token punctuation">,</span>
                        <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">mapping</span><span class="token punctuation">(</span><span class="token class-name">Employee</span><span class="token operator">::</span><span class="token function">getName</span><span class="token punctuation">,</span><span class="token comment">// ä¸‹æ¸¸æ”¶é›†å™¨</span>
                                <span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// æ›´ä¸‹æ¸¸çš„æ”¶é›†å™¨</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¦‚æœçœ‹åˆ°è¿™é‡Œä½ è¿˜æ²¡æœ‰å¯¹ Java å‡½æ•°å¼ç¼–ç¨‹å¤±å»ä¿¡å¿ƒï¼Œæ­å–œä½ ï¼Œä½ å·²ç»é¡ºåˆ©æˆä¸º Java å‡½æ•°å¼ç¼–ç¨‹å¤§å¸ˆäº†ã€‚</p><h3 id="ä½¿ç”¨-collect-åšå­—ç¬¦ä¸²-join" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-collect-åšå­—ç¬¦ä¸²-join" aria-hidden="true">#</a> ä½¿ç”¨ collect()åšå­—ç¬¦ä¸² join</h3><p>è¿™ä¸ªè‚¯å®šæ˜¯å¤§å®¶å–œé—»ä¹è§çš„åŠŸèƒ½ï¼Œå­—ç¬¦ä¸²æ‹¼æ¥æ—¶ä½¿ç”¨ Collectors.joining()ç”Ÿæˆçš„æ”¶é›†å™¨ï¼Œä»æ­¤å‘Šåˆ« for å¾ªç¯ã€‚Collectors.joining()æ–¹æ³•æœ‰ä¸‰ç§é‡å†™å½¢å¼ï¼Œåˆ†åˆ«å¯¹åº”ä¸‰ç§ä¸åŒçš„æ‹¼æ¥æ–¹å¼ã€‚æ— éœ€å¤šè¨€ï¼Œä»£ç è¿‡ç›®éš¾å¿˜ã€‚</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ä½¿ç”¨Collectors.joining()æ‹¼æ¥å­—ç¬¦ä¸²</span>
<span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> stream <span class="token operator">=</span> <span class="token class-name">Stream</span><span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token string">&quot;I&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;love&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;you&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//String joined = stream.collect(Collectors.joining());// &quot;Iloveyou&quot;</span>
<span class="token comment">//String joined = stream.collect(Collectors.joining(&quot;,&quot;));// &quot;I,love,you&quot;</span>
<span class="token class-name">String</span> joined <span class="token operator">=</span> stream<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">joining</span><span class="token punctuation">(</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;{&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// &quot;{I,love,you}&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="collect-è¿˜å¯ä»¥åšæ›´å¤š" tabindex="-1"><a class="header-anchor" href="#collect-è¿˜å¯ä»¥åšæ›´å¤š" aria-hidden="true">#</a> collect()è¿˜å¯ä»¥åšæ›´å¤š</h3><p>é™¤äº†å¯ä»¥ä½¿ç”¨ Collectors å·¥å…·ç±»å·²ç»å°è£…å¥½çš„æ”¶é›†å™¨ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è‡ªå®šä¹‰æ”¶é›†å™¨ï¼Œæˆ–è€…ç›´æ¥è°ƒç”¨<code>collect(Supplier&lt;R&gt; supplier, BiConsumer&lt;R,? super T&gt; accumulator, BiConsumer&lt;R,R&gt; combiner)</code>æ–¹æ³•ï¼Œæ”¶é›†ä»»ä½•å½¢å¼ä½ æƒ³è¦çš„ä¿¡æ¯ã€‚ä¸è¿‡ Collectors å·¥å…·ç±»åº”è¯¥èƒ½æ»¡è¶³æˆ‘ä»¬çš„ç»å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œæ‰‹åŠ¨å®ç°ä¹‹é—´è¯·å…ˆçœ‹çœ‹æ–‡æ¡£ã€‚</p><h2 id="stream-pipelines" tabindex="-1"><a class="header-anchor" href="#stream-pipelines" aria-hidden="true">#</a> Stream Pipelines</h2><p>å‰é¢æˆ‘ä»¬å·²ç»å­¦ä¼šå¦‚ä½•ä½¿ç”¨ Stream APIï¼Œç”¨èµ·æ¥çœŸçš„å¾ˆçˆ½ï¼Œä½†ç®€æ´çš„æ–¹æ³•ä¸‹é¢ä¼¼ä¹éšè—ç€æ— å°½çš„ç§˜å¯†ï¼Œå¦‚æ­¤å¼ºå¤§çš„ API æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿæ¯”å¦‚ Pipeline æ˜¯æ€ä¹ˆæ‰§è¡Œçš„ï¼Œæ¯æ¬¡æ–¹æ³•è°ƒç”¨éƒ½ä¼šå¯¼è‡´ä¸€æ¬¡è¿­ä»£å—ï¼Ÿè‡ªåŠ¨å¹¶è¡Œåˆæ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Œçº¿ç¨‹ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿæœ¬èŠ‚æˆ‘ä»¬å­¦ä¹  Stream æµæ°´çº¿çš„åŸç†ï¼Œè¿™æ˜¯ Stream å®ç°çš„å…³é”®æ‰€åœ¨ã€‚</p><p>é¦–å…ˆå›é¡¾ä¸€ä¸‹å®¹å™¨æ‰§è¡Œ Lambda è¡¨è¾¾å¼çš„æ–¹å¼ï¼Œä»¥ ArrayList.forEach()æ–¹æ³•ä¸ºä¾‹ï¼Œå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// ArrayList.forEach()</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">forEach</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">E</span><span class="token punctuation">&gt;</span></span> action<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> modCount <span class="token operator">==</span> expectedModCount <span class="token operator">&amp;&amp;</span> i <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        action<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>elementData<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// å›è°ƒæ–¹æ³•</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æˆ‘ä»¬çœ‹åˆ° ArrayList.forEach()æ–¹æ³•çš„ä¸»è¦é€»è¾‘å°±æ˜¯ä¸€ä¸ª for å¾ªç¯ï¼Œåœ¨è¯¥ for å¾ªç¯é‡Œä¸æ–­è°ƒç”¨ action.accept()å›è°ƒæ–¹æ³•å®Œæˆå¯¹å…ƒç´ çš„éå†ã€‚è¿™å®Œå…¨æ²¡æœ‰ä»€ä¹ˆæ–°å¥‡ä¹‹å¤„ï¼Œå›è°ƒæ–¹æ³•åœ¨ Java GUI çš„ç›‘å¬å™¨ä¸­å¹¿æ³›ä½¿ç”¨ã€‚Lambda è¡¨è¾¾å¼çš„ä½œç”¨å°±æ˜¯ç›¸å½“äºä¸€ä¸ªå›è°ƒæ–¹æ³•ï¼Œè¿™å¾ˆå¥½ç†è§£ã€‚</p><p>Stream API ä¸­å¤§é‡ä½¿ç”¨ Lambda è¡¨è¾¾å¼ä½œä¸ºå›è°ƒæ–¹æ³•ï¼Œä½†è¿™å¹¶ä¸æ˜¯å…³é”®ã€‚ç†è§£ Stream æˆ‘ä»¬æ›´å…³å¿ƒçš„æ˜¯å¦å¤–ä¸¤ä¸ªé—®é¢˜ï¼šæµæ°´çº¿å’Œè‡ªåŠ¨å¹¶è¡Œã€‚ä½¿ç”¨ Stream æˆ–è®¸å¾ˆå®¹æ˜“å†™å…¥å¦‚ä¸‹å½¢å¼çš„ä»£ç ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">int</span> longestStringLengthStartingWithA
        <span class="token operator">=</span> strings<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> s<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">mapToInt</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token operator">::</span><span class="token function">length</span><span class="token punctuation">)</span>
              <span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç æ±‚å‡ºä»¥å­—æ¯ A å¼€å¤´çš„å­—ç¬¦ä¸²çš„æœ€å¤§é•¿åº¦ï¼Œä¸€ç§ç›´ç™½çš„æ–¹å¼æ˜¯ä¸ºæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½æ‰§ä¸€æ¬¡è¿­ä»£ï¼Œè¿™æ ·åšèƒ½å¤Ÿå®ç°åŠŸèƒ½ï¼Œä½†æ•ˆç‡ä¸Šè‚¯å®šæ˜¯æ— æ³•æ¥å—çš„ã€‚ç±»åº“çš„å®ç°ç€ä½¿ç”¨æµæ°´çº¿ï¼ˆPipelineï¼‰çš„æ–¹å¼å·§å¦™çš„é¿å…äº†å¤šæ¬¡è¿­ä»£ï¼Œå…¶åŸºæœ¬æ€æƒ³æ˜¯åœ¨ä¸€æ¬¡è¿­ä»£ä¸­å°½å¯èƒ½å¤šçš„æ‰§è¡Œç”¨æˆ·æŒ‡å®šçš„æ“ä½œã€‚ä¸ºè®²è§£æ–¹ä¾¿æˆ‘ä»¬æ±‡æ€»äº† Stream çš„æ‰€æœ‰æ“ä½œã€‚</p><table width="600"><tr><td colspan="3" align="center" border="0">Streamæ“ä½œåˆ†ç±»</td></tr><tr><td rowspan="2" border="1">ä¸­é—´æ“ä½œ(Intermediate operations)</td><td>æ— çŠ¶æ€(Stateless)</td><td>unordered() filter() map() mapToInt() mapToLong() mapToDouble() flatMap() flatMapToInt() flatMapToLong() flatMapToDouble() peek()</td></tr><tr><td>æœ‰çŠ¶æ€(Stateful)</td><td>distinct() sorted() sorted() limit() skip() </td></tr><tr><td rowspan="2" border="1">ç»“æŸæ“ä½œ(Terminal operations)</td><td>éçŸ­è·¯æ“ä½œ</td><td>forEach() forEachOrdered() toArray() reduce() collect() max() min() count()</td></tr><tr><td>çŸ­è·¯æ“ä½œ(short-circuiting)</td><td>anyMatch() allMatch() noneMatch() findFirst() findAny()</td></tr></table><p>Stream ä¸Šçš„æ‰€æœ‰æ“ä½œåˆ†ä¸ºä¸¤ç±»ï¼šä¸­é—´æ“ä½œå’Œç»“æŸæ“ä½œï¼Œä¸­é—´æ“ä½œåªæ˜¯ä¸€ç§æ ‡è®°ï¼Œåªæœ‰ç»“æŸæ“ä½œæ‰ä¼šè§¦å‘å®é™…è®¡ç®—ã€‚ä¸­é—´æ“ä½œåˆå¯ä»¥åˆ†ä¸ºæ— çŠ¶æ€çš„(Stateless)å’Œæœ‰çŠ¶æ€çš„(Stateful)ï¼Œæ— çŠ¶æ€ä¸­é—´æ“ä½œæ˜¯æŒ‡å…ƒç´ çš„å¤„ç†ä¸å—å‰é¢å…ƒç´ çš„å½±å“ï¼Œè€Œæœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œå¿…é¡»ç­‰åˆ°æ‰€æœ‰å…ƒç´ å¤„ç†ä¹‹åæ‰çŸ¥é“æœ€ç»ˆç»“æœï¼Œæ¯”å¦‚æ’åºæ˜¯æœ‰çŠ¶æ€æ“ä½œï¼Œåœ¨è¯»å–æ‰€æœ‰å…ƒç´ ä¹‹å‰å¹¶ä¸èƒ½ç¡®å®šæ’åºç»“æœï¼›ç»“æŸæ“ä½œåˆå¯ä»¥åˆ†ä¸ºçŸ­è·¯æ“ä½œå’ŒéçŸ­è·¯æ“ä½œï¼ŒçŸ­è·¯æ“ä½œæ˜¯æŒ‡ä¸ç”¨å¤„ç†å…¨éƒ¨å…ƒç´ å°±å¯ä»¥è¿”å›ç»“æœï¼Œæ¯”å¦‚æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ ã€‚ä¹‹æ‰€ä»¥è¦è¿›è¡Œå¦‚æ­¤ç²¾ç»†çš„åˆ’åˆ†ï¼Œæ˜¯å› ä¸ºåº•å±‚å¯¹æ¯ä¸€ç§æƒ…å†µçš„å¤„ç†æ–¹å¼ä¸åŒã€‚</p><h3 id="ä¸€ç§ç›´ç™½çš„å®ç°æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#ä¸€ç§ç›´ç™½çš„å®ç°æ–¹å¼" aria-hidden="true">#</a> ä¸€ç§ç›´ç™½çš„å®ç°æ–¹å¼</h3><figure><img src="/v2/Stream_pipeline_naive.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>ä»ç„¶è€ƒè™‘ä¸Šè¿°æ±‚æœ€é•¿å­—ç¬¦ä¸²çš„ç¨‹åºï¼Œä¸€ç§ç›´ç™½çš„æµæ°´çº¿å®ç°æ–¹å¼æ˜¯ä¸ºæ¯ä¸€æ¬¡å‡½æ•°è°ƒç”¨éƒ½æ‰§ä¸€æ¬¡è¿­ä»£ï¼Œå¹¶å°†å¤„ç†ä¸­é—´ç»“æœæ”¾åˆ°æŸç§æ•°æ®ç»“æ„ä¸­ï¼ˆæ¯”å¦‚æ•°ç»„ï¼Œå®¹å™¨ç­‰ï¼‰ã€‚å…·ä½“è¯´æ¥ï¼Œå°±æ˜¯è°ƒç”¨ filter()æ–¹æ³•åç«‹å³æ‰§è¡Œï¼Œé€‰å‡ºæ‰€æœ‰ä»¥ A å¼€å¤´çš„å­—ç¬¦ä¸²å¹¶æ”¾åˆ°ä¸€ä¸ªåˆ—è¡¨ list1 ä¸­ï¼Œä¹‹åè®© list1 ä¼ é€’ç»™ mapToInt()æ–¹æ³•å¹¶ç«‹å³æ‰§è¡Œï¼Œç”Ÿæˆçš„ç»“æœæ”¾åˆ° list2 ä¸­ï¼Œæœ€åéå† list2 æ‰¾å‡ºæœ€å¤§çš„æ•°å­—ä½œä¸ºæœ€ç»ˆç»“æœã€‚ç¨‹åºçš„æ‰§è¡Œæµç¨‹å¦‚å¦‚æ‰€ç¤ºï¼š</p><p>è¿™æ ·åšå®ç°èµ·æ¥éå¸¸ç®€å•ç›´è§‚ï¼Œä½†æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼š</p><ol><li>è¿­ä»£æ¬¡æ•°å¤šã€‚è¿­ä»£æ¬¡æ•°è·Ÿå‡½æ•°è°ƒç”¨çš„æ¬¡æ•°ç›¸ç­‰ã€‚</li><li>é¢‘ç¹äº§ç”Ÿä¸­é—´ç»“æœã€‚æ¯æ¬¡å‡½æ•°è°ƒç”¨éƒ½äº§ç”Ÿä¸€æ¬¡ä¸­é—´ç»“æœï¼Œå­˜å‚¨å¼€é”€æ— æ³•æ¥å—ã€‚</li></ol><p>è¿™äº›å¼Šç«¯ä½¿å¾—æ•ˆç‡åº•ä¸‹ï¼Œæ ¹æœ¬æ— æ³•æ¥å—ã€‚å¦‚æœä¸ä½¿ç”¨ Stream API æˆ‘ä»¬éƒ½çŸ¥é“ä¸Šè¿°ä»£ç è¯¥å¦‚ä½•åœ¨ä¸€æ¬¡è¿­ä»£ä¸­å®Œæˆï¼Œå¤§è‡´æ˜¯å¦‚ä¸‹å½¢å¼ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">int</span> longest <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token class-name">String</span> str <span class="token operator">:</span> strings<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">startsWith</span><span class="token punctuation">(</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 1. filter(), ä¿ç•™ä»¥Aå¼€å¤´çš„å­—ç¬¦ä¸²</span>
        <span class="token keyword">int</span> len <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. mapToInt(), è½¬æ¢æˆé•¿åº¦</span>
        longest <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>len<span class="token punctuation">,</span> longest<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 3. max(), ä¿ç•™æœ€é•¿çš„é•¿åº¦</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>é‡‡ç”¨è¿™ç§æ–¹å¼æˆ‘ä»¬ä¸ä½†å‡å°‘äº†è¿­ä»£æ¬¡æ•°ï¼Œä¹Ÿé¿å…äº†å­˜å‚¨ä¸­é—´ç»“æœï¼Œæ˜¾ç„¶è¿™å°±æ˜¯æµæ°´çº¿ï¼Œå› ä¸ºæˆ‘ä»¬æŠŠä¸‰ä¸ªæ“ä½œæ”¾åœ¨äº†ä¸€æ¬¡è¿­ä»£å½“ä¸­ã€‚åªè¦æˆ‘ä»¬äº‹å…ˆçŸ¥é“ç”¨æˆ·æ„å›¾ï¼Œæ€»æ˜¯èƒ½å¤Ÿé‡‡ç”¨ä¸Šè¿°æ–¹å¼å®ç°è·Ÿ Stream API ç­‰ä»·çš„åŠŸèƒ½ï¼Œä½†é—®é¢˜æ˜¯ Stream ç±»åº“çš„è®¾è®¡è€…å¹¶ä¸çŸ¥é“ç”¨æˆ·çš„æ„å›¾æ˜¯ä»€ä¹ˆã€‚å¦‚ä½•åœ¨æ— æ³•å‡è®¾ç”¨æˆ·è¡Œä¸ºçš„å‰æä¸‹å®ç°æµæ°´çº¿ï¼Œæ˜¯ç±»åº“çš„è®¾è®¡è€…è¦è€ƒè™‘çš„é—®é¢˜ã€‚</p><h3 id="stream-æµæ°´çº¿è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#stream-æµæ°´çº¿è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> Stream æµæ°´çº¿è§£å†³æ–¹æ¡ˆ</h3><p>æˆ‘ä»¬å¤§è‡´èƒ½å¤Ÿæƒ³åˆ°ï¼Œåº”è¯¥é‡‡ç”¨æŸç§æ–¹å¼è®°å½•ç”¨æˆ·æ¯ä¸€æ­¥çš„æ“ä½œï¼Œå½“ç”¨æˆ·è°ƒç”¨ç»“æŸæ“ä½œæ—¶å°†ä¹‹å‰è®°å½•çš„æ“ä½œå åŠ åˆ°ä¸€èµ·åœ¨ä¸€æ¬¡è¿­ä»£ä¸­å…¨éƒ¨æ‰§è¡Œæ‰ã€‚æ²¿ç€è¿™ä¸ªæ€è·¯ï¼Œæœ‰å‡ ä¸ªé—®é¢˜éœ€è¦è§£å†³ï¼š</p><ol><li>ç”¨æˆ·çš„æ“ä½œå¦‚ä½•è®°å½•ï¼Ÿ</li><li>æ“ä½œå¦‚ä½•å åŠ ï¼Ÿ</li><li>å åŠ ä¹‹åçš„æ“ä½œå¦‚ä½•æ‰§è¡Œï¼Ÿ</li><li>æ‰§è¡Œåçš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰åœ¨å“ªé‡Œï¼Ÿ</li></ol><h4 id="æ“ä½œå¦‚ä½•è®°å½•" tabindex="-1"><a class="header-anchor" href="#æ“ä½œå¦‚ä½•è®°å½•" aria-hidden="true">#</a> æ“ä½œå¦‚ä½•è®°å½•ï¼Ÿ</h4><figure><img src="/v2/Java_stream_pipeline_classes.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>æ³¨æ„è¿™é‡Œä½¿ç”¨çš„æ˜¯â€œæ“ä½œ(operation)â€ä¸€è¯ï¼ŒæŒ‡çš„æ˜¯â€œStream ä¸­é—´æ“ä½œâ€çš„æ“ä½œï¼Œå¾ˆå¤š Stream æ“ä½œä¼šéœ€è¦ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼ˆLambda è¡¨è¾¾å¼ï¼‰ï¼Œå› æ­¤ä¸€ä¸ªå®Œæ•´çš„æ“ä½œæ˜¯&lt;æ•°æ®æ¥æºï¼Œæ“ä½œï¼Œå›è°ƒå‡½æ•°&gt;æ„æˆçš„ä¸‰å…ƒç»„ã€‚Stream ä¸­ä½¿ç”¨ Stage çš„æ¦‚å¿µæ¥æè¿°ä¸€ä¸ªå®Œæ•´çš„æ“ä½œï¼Œå¹¶ç”¨æŸç§å®ä¾‹åŒ–åçš„ PipelineHelper æ¥ä»£è¡¨ Stageï¼Œå°†å…·æœ‰å…ˆåé¡ºåºçš„å„ä¸ª Stage è¿åˆ°ä¸€èµ·ï¼Œå°±æ„æˆäº†æ•´ä¸ªæµæ°´çº¿ã€‚è·Ÿ Stream ç›¸å…³ç±»å’Œæ¥å£çš„ç»§æ‰¿å…³ç³»å›¾ç¤ºã€‚</p><p>è¿˜æœ‰ IntPipeline, LongPipeline, DoublePipeline æ²¡åœ¨å›¾ä¸­ç”»å‡ºï¼Œè¿™ä¸‰ä¸ªç±»ä¸“é—¨ä¸ºä¸‰ç§åŸºæœ¬ç±»å‹ï¼ˆä¸æ˜¯åŒ…è£…ç±»å‹ï¼‰è€Œå®šåˆ¶çš„ï¼Œè·Ÿ ReferencePipeline æ˜¯å¹¶åˆ—å…³ç³»ã€‚å›¾ä¸­ Head ç”¨äºè¡¨ç¤ºç¬¬ä¸€ä¸ª Stageï¼Œå³è°ƒç”¨è°ƒç”¨è¯¸å¦‚ Collection.stream()æ–¹æ³•äº§ç”Ÿçš„ Stageï¼Œå¾ˆæ˜¾ç„¶è¿™ä¸ª Stage é‡Œä¸åŒ…å«ä»»ä½•æ“ä½œï¼›StatelessOp å’Œ StatefulOp åˆ†åˆ«è¡¨ç¤ºæ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„ Stageï¼Œå¯¹åº”äºæ— çŠ¶æ€å’Œæœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œã€‚</p><p>Stream æµæ°´çº¿ç»„ç»‡ç»“æ„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š</p><figure><img src="/v2/Stream_pipeline_example.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>å›¾ä¸­é€šè¿‡ Collection.stream()æ–¹æ³•å¾—åˆ° Head ä¹Ÿå°±æ˜¯ stage0ï¼Œç´§æ¥ç€è°ƒç”¨ä¸€ç³»åˆ—çš„ä¸­é—´æ“ä½œï¼Œä¸æ–­äº§ç”Ÿæ–°çš„ Streamã€‚è¿™äº› Stream å¯¹è±¡ä»¥åŒå‘é“¾è¡¨çš„å½¢å¼ç»„ç»‡åœ¨ä¸€èµ·ï¼Œæ„æˆæ•´ä¸ªæµæ°´çº¿ï¼Œç”±äºæ¯ä¸ª Stage éƒ½è®°å½•äº†å‰ä¸€ä¸ª Stage å’Œæœ¬æ¬¡çš„æ“ä½œä»¥åŠå›è°ƒå‡½æ•°ï¼Œä¾é è¿™ç§ç»“æ„å°±èƒ½å»ºç«‹èµ·å¯¹æ•°æ®æºçš„æ‰€æœ‰æ“ä½œã€‚è¿™å°±æ˜¯ Stream è®°å½•æ“ä½œçš„æ–¹å¼ã€‚</p><h4 id="æ“ä½œå¦‚ä½•å åŠ " tabindex="-1"><a class="header-anchor" href="#æ“ä½œå¦‚ä½•å åŠ " aria-hidden="true">#</a> æ“ä½œå¦‚ä½•å åŠ ï¼Ÿ</h4><p>ä»¥ä¸Šåªæ˜¯è§£å†³äº†æ“ä½œè®°å½•çš„é—®é¢˜ï¼Œè¦æƒ³è®©æµæ°´çº¿èµ·åˆ°åº”æœ‰çš„ä½œç”¨æˆ‘ä»¬éœ€è¦ä¸€ç§å°†æ‰€æœ‰æ“ä½œå åŠ åˆ°ä¸€èµ·çš„æ–¹æ¡ˆã€‚ä½ å¯èƒ½ä¼šè§‰å¾—è¿™å¾ˆç®€å•ï¼Œåªéœ€è¦ä»æµæ°´çº¿çš„ head å¼€å§‹ä¾æ¬¡æ‰§è¡Œæ¯ä¸€æ­¥çš„æ“ä½œï¼ˆåŒ…æ‹¬å›è°ƒå‡½æ•°ï¼‰å°±è¡Œäº†ã€‚è¿™å¬èµ·æ¥ä¼¼ä¹æ˜¯å¯è¡Œçš„ï¼Œä½†æ˜¯ä½ å¿½ç•¥äº†å‰é¢çš„ Stage å¹¶ä¸çŸ¥é“åé¢ Stage åˆ°åº•æ‰§è¡Œäº†å“ªç§æ“ä½œï¼Œä»¥åŠå›è°ƒå‡½æ•°æ˜¯å“ªç§å½¢å¼ã€‚æ¢å¥è¯è¯´ï¼Œåªæœ‰å½“å‰ Stage æœ¬èº«æ‰çŸ¥é“è¯¥å¦‚ä½•æ‰§è¡Œè‡ªå·±åŒ…å«çš„åŠ¨ä½œã€‚è¿™å°±éœ€è¦æœ‰æŸç§åè®®æ¥åè°ƒç›¸é‚» Stage ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚</p><p>è¿™ç§åè®®ç”± Sink æ¥å£å®Œæˆï¼ŒSink æ¥å£åŒ…å«çš„æ–¹æ³•å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><p>æ–¹æ³•å ä½œç”¨</p><table width="600px"><tr><td align="center">æ–¹æ³•å</td><td align="center">ä½œç”¨</td></tr><tr><td>void begin(long size)</td><td>å¼€å§‹éå†å…ƒç´ ä¹‹å‰è°ƒç”¨è¯¥æ–¹æ³•ï¼Œé€šçŸ¥Sinkåšå¥½å‡†å¤‡ã€‚</td></tr><tr><td>void end()</td><td>æ‰€æœ‰å…ƒç´ éå†å®Œæˆä¹‹åè°ƒç”¨ï¼Œé€šçŸ¥Sinkæ²¡æœ‰æ›´å¤šçš„å…ƒç´ äº†ã€‚</td></tr><tr><td>boolean cancellationRequested()</td><td>æ˜¯å¦å¯ä»¥ç»“æŸæ“ä½œï¼Œå¯ä»¥è®©çŸ­è·¯æ“ä½œå°½æ—©ç»“æŸã€‚</td></tr><tr><td>void accept(T t)</td><td>éå†å…ƒç´ æ—¶è°ƒç”¨ï¼Œæ¥å—ä¸€ä¸ªå¾…å¤„ç†å…ƒç´ ï¼Œå¹¶å¯¹å…ƒç´ è¿›è¡Œå¤„ç†ã€‚StageæŠŠè‡ªå·±åŒ…å«çš„æ“ä½œå’Œå›è°ƒæ–¹æ³•å°è£…åˆ°è¯¥æ–¹æ³•é‡Œï¼Œå‰ä¸€ä¸ªStageåªéœ€è¦è°ƒç”¨å½“å‰Stage.accept(T t)æ–¹æ³•å°±è¡Œäº†ã€‚</td></tr></table><p>æœ‰äº†ä¸Šé¢çš„åè®®ï¼Œç›¸é‚» Stage ä¹‹é—´è°ƒç”¨å°±å¾ˆæ–¹ä¾¿äº†ï¼Œæ¯ä¸ª Stage éƒ½ä¼šå°†è‡ªå·±çš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª Sink é‡Œï¼Œå‰ä¸€ä¸ª Stage åªéœ€è°ƒç”¨åä¸€ä¸ª Stage çš„ accept()æ–¹æ³•å³å¯ï¼Œå¹¶ä¸éœ€è¦çŸ¥é“å…¶å†…éƒ¨æ˜¯å¦‚ä½•å¤„ç†çš„ã€‚å½“ç„¶å¯¹äºæœ‰çŠ¶æ€çš„æ“ä½œï¼ŒSink çš„ begin()å’Œ end()æ–¹æ³•ä¹Ÿæ˜¯å¿…é¡»å®ç°çš„ã€‚æ¯”å¦‚ Stream.sorted()æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œï¼Œå…¶å¯¹åº”çš„ Sink.begin()æ–¹æ³•å¯èƒ½åˆ›å»ºä¸€ä¸ªä¹˜æ”¾ç»“æœçš„å®¹å™¨ï¼Œè€Œ accept()æ–¹æ³•è´Ÿè´£å°†å…ƒç´ æ·»åŠ åˆ°è¯¥å®¹å™¨ï¼Œæœ€å end()è´Ÿè´£å¯¹å®¹å™¨è¿›è¡Œæ’åºã€‚å¯¹äºçŸ­è·¯æ“ä½œï¼ŒSink.cancellationRequested()ä¹Ÿæ˜¯å¿…é¡»å®ç°çš„ï¼Œæ¯”å¦‚ Stream.findFirst()æ˜¯çŸ­è·¯æ“ä½œï¼Œåªè¦æ‰¾åˆ°ä¸€ä¸ªå…ƒç´ ï¼ŒcancellationRequested()å°±åº”è¯¥è¿”å› trueï¼Œä»¥ä¾¿è°ƒç”¨è€…å°½å¿«ç»“æŸæŸ¥æ‰¾ã€‚Sink çš„å››ä¸ªæ¥å£æ–¹æ³•å¸¸å¸¸ç›¸äº’åä½œï¼Œå…±åŒå®Œæˆè®¡ç®—ä»»åŠ¡ã€‚å®é™…ä¸Š Stream API å†…éƒ¨å®ç°çš„çš„æœ¬è´¨ï¼Œå°±æ˜¯å¦‚ä½•é‡è½½ Sink çš„è¿™å››ä¸ªæ¥å£æ–¹æ³•ã€‚</p><p>æœ‰äº† Sink å¯¹æ“ä½œçš„åŒ…è£…ï¼ŒStage ä¹‹é—´çš„è°ƒç”¨é—®é¢˜å°±è§£å†³äº†ï¼Œæ‰§è¡Œæ—¶åªéœ€è¦ä»æµæ°´çº¿çš„ head å¼€å§‹å¯¹æ•°æ®æºä¾æ¬¡è°ƒç”¨æ¯ä¸ª Stage å¯¹åº”çš„ Sink.{begin(), accept(), cancellationRequested(), end()}æ–¹æ³•å°±å¯ä»¥äº†ã€‚ä¸€ç§å¯èƒ½çš„ Sink.accept()æ–¹æ³•æµç¨‹æ˜¯è¿™æ ·çš„ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">U</span> u<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token number">1.</span> ä½¿ç”¨å½“å‰<span class="token class-name">Sink</span>åŒ…è£…çš„å›è°ƒå‡½æ•°å¤„ç†u
    <span class="token number">2.</span> å°†å¤„ç†ç»“æœä¼ é€’ç»™æµæ°´çº¿ä¸‹æ¸¸çš„<span class="token class-name">Sink</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sink æ¥å£çš„å…¶ä»–å‡ ä¸ªæ–¹æ³•ä¹Ÿæ˜¯æŒ‰ç…§è¿™ç§[å¤„ç†-&gt;è½¬å‘]çš„æ¨¡å‹å®ç°ã€‚ä¸‹é¢æˆ‘ä»¬ç»“åˆå…·ä½“ä¾‹å­çœ‹çœ‹ Stream çš„ä¸­é—´æ“ä½œæ˜¯å¦‚ä½•å°†è‡ªèº«çš„æ“ä½œåŒ…è£…æˆ Sink ä»¥åŠ Sink æ˜¯å¦‚ä½•å°†å¤„ç†ç»“æœè½¬å‘ç»™ä¸‹ä¸€ä¸ª Sink çš„ã€‚å…ˆçœ‹ Stream.map()æ–¹æ³•ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Stream.map()ï¼Œè°ƒç”¨è¯¥æ–¹æ³•å°†äº§ç”Ÿä¸€ä¸ªæ–°çš„Stream</span>
<span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Stream</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> P_OUT<span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StatelessOp</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token class-name">StreamShape</span><span class="token punctuation">.</span><span class="token constant">REFERENCE</span><span class="token punctuation">,</span>
                                 <span class="token class-name">StreamOpFlag</span><span class="token punctuation">.</span><span class="token constant">NOT_SORTED</span> <span class="token operator">|</span> <span class="token class-name">StreamOpFlag</span><span class="token punctuation">.</span><span class="token constant">NOT_DISTINCT</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span> <span class="token comment">/*opWripSink()æ–¹æ³•è¿”å›ç”±å›è°ƒå‡½æ•°åŒ…è£…è€ŒæˆSink*/</span>
        <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">&gt;</span></span> <span class="token function">opWrapSink</span><span class="token punctuation">(</span><span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">R</span><span class="token punctuation">&gt;</span></span> downstream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Sink<span class="token punctuation">.</span>ChainedReference</span><span class="token generics"><span class="token punctuation">&lt;</span>P_OUT<span class="token punctuation">,</span> <span class="token class-name">R</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>downstream<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token annotation punctuation">@Override</span>
                <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">P_OUT</span> u<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">R</span> r <span class="token operator">=</span> mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1. ä½¿ç”¨å½“å‰SinkåŒ…è£…çš„å›è°ƒå‡½æ•°mapperå¤„ç†u</span>
                    downstream<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. å°†å¤„ç†ç»“æœä¼ é€’ç»™æµæ°´çº¿ä¸‹æ¸¸çš„Sink</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç çœ‹ä¼¼å¤æ‚ï¼Œå…¶å®é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯å°†å›è°ƒå‡½æ•° mapper åŒ…è£…åˆ°ä¸€ä¸ª Sink å½“ä¸­ã€‚ç”±äº Stream.map()æ˜¯ä¸€ä¸ªæ— çŠ¶æ€çš„ä¸­é—´æ“ä½œï¼Œæ‰€ä»¥ map()æ–¹æ³•è¿”å›äº†ä¸€ä¸ª StatelessOp å†…éƒ¨ç±»å¯¹è±¡ï¼ˆä¸€ä¸ªæ–°çš„ Streamï¼‰ï¼Œè°ƒç”¨è¿™ä¸ªæ–° Stream çš„ opWripSink()æ–¹æ³•å°†å¾—åˆ°ä¸€ä¸ªåŒ…è£…äº†å½“å‰å›è°ƒå‡½æ•°çš„ Sinkã€‚</p><p>å†æ¥çœ‹ä¸€ä¸ªå¤æ‚ä¸€ç‚¹çš„ä¾‹å­ã€‚Stream.sorted()æ–¹æ³•å°†å¯¹ Stream ä¸­çš„å…ƒç´ è¿›è¡Œæ’åºï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸€ä¸ªæœ‰çŠ¶æ€çš„ä¸­é—´æ“ä½œï¼Œå› ä¸ºè¯»å–æ‰€æœ‰å…ƒç´ ä¹‹å‰æ˜¯æ²¡æ³•å¾—åˆ°æœ€ç»ˆé¡ºåºçš„ã€‚æŠ›å¼€æ¨¡æ¿ä»£ç ç›´æ¥è¿›å…¥é—®é¢˜æœ¬è´¨ï¼Œsorted()æ–¹æ³•æ˜¯å¦‚ä½•å°†æ“ä½œå°è£…æˆ Sink çš„å‘¢ï¼Ÿsorted()ä¸€ç§å¯èƒ½å°è£…çš„ Sink ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// Stream.sort()æ–¹æ³•ç”¨åˆ°çš„Sinkå®ç°</span>
<span class="token keyword">class</span> <span class="token class-name">RefSortingSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRefSortingSink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> list<span class="token punctuation">;</span><span class="token comment">// å­˜æ”¾ç”¨äºæ’åºçš„å…ƒç´ </span>
    <span class="token class-name">RefSortingSink</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> downstream<span class="token punctuation">,</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> comparator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>downstream<span class="token punctuation">,</span> comparator<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">begin</span><span class="token punctuation">(</span><span class="token keyword">long</span> size<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token comment">// åˆ›å»ºä¸€ä¸ªå­˜æ”¾æ’åºå…ƒç´ çš„åˆ—è¡¨</span>
        list <span class="token operator">=</span> <span class="token punctuation">(</span>size <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> size<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>comparator<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// åªæœ‰å…ƒç´ å…¨éƒ¨æ¥æ”¶ä¹‹åæ‰èƒ½å¼€å§‹æ’åº</span>
        downstream<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cancellationWasRequested<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// ä¸‹æ¸¸Sinkä¸åŒ…å«çŸ­è·¯æ“ä½œ</span>
            list<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>downstream<span class="token operator">::</span><span class="token function">accept</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. å°†å¤„ç†ç»“æœä¼ é€’ç»™æµæ°´çº¿ä¸‹æ¸¸çš„Sink</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token comment">// ä¸‹æ¸¸SinkåŒ…å«çŸ­è·¯æ“ä½œ</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">T</span> t <span class="token operator">:</span> list<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">// æ¯æ¬¡éƒ½è°ƒç”¨cancellationRequested()è¯¢é—®æ˜¯å¦å¯ä»¥ç»“æŸå¤„ç†ã€‚</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>downstream<span class="token punctuation">.</span><span class="token function">cancellationRequested</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                downstream<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 2. å°†å¤„ç†ç»“æœä¼ é€’ç»™æµæ°´çº¿ä¸‹æ¸¸çš„Sink</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        downstream<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        list <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 1. ä½¿ç”¨å½“å‰SinkåŒ…è£…åŠ¨ä½œå¤„ç†tï¼Œåªæ˜¯ç®€å•çš„å°†å…ƒç´ æ·»åŠ åˆ°ä¸­é—´åˆ—è¡¨å½“ä¸­</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç å®Œç¾çš„å±•ç°äº† Sink çš„å››ä¸ªæ¥å£æ–¹æ³•æ˜¯å¦‚ä½•ååŒå·¥ä½œçš„ï¼š</p><p>é¦–å…ˆ beging()æ–¹æ³•å‘Šè¯‰ Sink å‚ä¸æ’åºçš„å…ƒç´ ä¸ªæ•°ï¼Œæ–¹ä¾¿ç¡®å®šä¸­é—´ç»“æœå®¹å™¨çš„çš„å¤§å°ï¼› ä¹‹åé€šè¿‡ accept()æ–¹æ³•å°†å…ƒç´ æ·»åŠ åˆ°ä¸­é—´ç»“æœå½“ä¸­ï¼Œæœ€ç»ˆæ‰§è¡Œæ—¶è°ƒç”¨è€…ä¼šä¸æ–­è°ƒç”¨è¯¥æ–¹æ³•ï¼Œç›´åˆ°éå†æ‰€æœ‰å…ƒç´ ï¼› æœ€å end()æ–¹æ³•å‘Šè¯‰ Sink æ‰€æœ‰å…ƒç´ éå†å®Œæ¯•ï¼Œå¯åŠ¨æ’åºæ­¥éª¤ï¼Œæ’åºå®Œæˆåå°†ç»“æœä¼ é€’ç»™ä¸‹æ¸¸çš„ Sinkï¼› å¦‚æœä¸‹æ¸¸çš„ Sink æ˜¯çŸ­è·¯æ“ä½œï¼Œå°†ç»“æœä¼ é€’ç»™ä¸‹æ¸¸æ—¶ä¸æ–­è¯¢é—®ä¸‹æ¸¸ cancellationRequested()æ˜¯å¦å¯ä»¥ç»“æŸå¤„ç†ã€‚</p><h4 id="å åŠ ä¹‹åçš„æ“ä½œå¦‚ä½•æ‰§è¡Œ" tabindex="-1"><a class="header-anchor" href="#å åŠ ä¹‹åçš„æ“ä½œå¦‚ä½•æ‰§è¡Œ" aria-hidden="true">#</a> å åŠ ä¹‹åçš„æ“ä½œå¦‚ä½•æ‰§è¡Œï¼Ÿ</h4><figure><img src="/v2/Stream_pipeline_Sink.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>Sink å®Œç¾å°è£…äº† Stream æ¯ä¸€æ­¥æ“ä½œï¼Œå¹¶ç»™å‡ºäº†[å¤„ç†-&gt;è½¬å‘]çš„æ¨¡å¼æ¥å åŠ æ“ä½œã€‚è¿™ä¸€è¿ä¸²çš„é½¿è½®å·²ç»å’¬åˆï¼Œå°±å·®æœ€åä¸€æ­¥æ‹¨åŠ¨é½¿è½®å¯åŠ¨æ‰§è¡Œã€‚æ˜¯ä»€ä¹ˆå¯åŠ¨è¿™ä¸€è¿ä¸²çš„æ“ä½œå‘¢ï¼Ÿä¹Ÿè®¸ä½ å·²ç»æƒ³åˆ°äº†å¯åŠ¨çš„åŸå§‹åŠ¨åŠ›å°±æ˜¯ç»“æŸæ“ä½œ(Terminal Operation)ï¼Œä¸€æ—¦è°ƒç”¨æŸä¸ªç»“æŸæ“ä½œï¼Œå°±ä¼šè§¦å‘æ•´ä¸ªæµæ°´çº¿çš„æ‰§è¡Œã€‚</p><p>ç»“æŸæ“ä½œä¹‹åä¸èƒ½å†æœ‰åˆ«çš„æ“ä½œï¼Œæ‰€ä»¥ç»“æŸæ“ä½œä¸ä¼šåˆ›å»ºæ–°çš„æµæ°´çº¿é˜¶æ®µ(Stage)ï¼Œç›´è§‚çš„è¯´å°±æ˜¯æµæ°´çº¿çš„é“¾è¡¨ä¸ä¼šåœ¨å¾€åå»¶ä¼¸äº†ã€‚ç»“æŸæ“ä½œä¼šåˆ›å»ºä¸€ä¸ªåŒ…è£…äº†è‡ªå·±æ“ä½œçš„ Sinkï¼Œè¿™ä¹Ÿæ˜¯æµæ°´çº¿ä¸­æœ€åä¸€ä¸ª Sinkï¼Œè¿™ä¸ª Sink åªéœ€è¦å¤„ç†æ•°æ®è€Œä¸éœ€è¦å°†ç»“æœä¼ é€’ç»™ä¸‹æ¸¸çš„ Sinkï¼ˆå› ä¸ºæ²¡æœ‰ä¸‹æ¸¸ï¼‰ã€‚å¯¹äº Sink çš„[å¤„ç†-&gt;è½¬å‘]æ¨¡å‹ï¼Œç»“æŸæ“ä½œçš„ Sink å°±æ˜¯è°ƒç”¨é“¾çš„å‡ºå£ã€‚</p><p>æˆ‘ä»¬å†æ¥è€ƒå¯Ÿä¸€ä¸‹ä¸Šæ¸¸çš„ Sink æ˜¯å¦‚ä½•æ‰¾åˆ°ä¸‹æ¸¸ Sink çš„ã€‚ä¸€ç§å¯é€‰çš„æ–¹æ¡ˆæ˜¯åœ¨ PipelineHelper ä¸­è®¾ç½®ä¸€ä¸ª Sink å­—æ®µï¼Œåœ¨æµæ°´çº¿ä¸­æ‰¾åˆ°ä¸‹æ¸¸ Stage å¹¶è®¿é—® Sink å­—æ®µå³å¯ã€‚ä½† Stream ç±»åº“çš„è®¾è®¡è€…æ²¡æœ‰è¿™ä¹ˆåšï¼Œè€Œæ˜¯è®¾ç½®äº†ä¸€ä¸ª Sink AbstractPipeline.opWrapSink(int flags, Sink downstream)æ–¹æ³•æ¥å¾—åˆ° Sinkï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯è¿”å›ä¸€ä¸ªæ–°çš„åŒ…å«äº†å½“å‰ Stage ä»£è¡¨çš„æ“ä½œä»¥åŠèƒ½å¤Ÿå°†ç»“æœä¼ é€’ç»™ downstream çš„ Sink å¯¹è±¡ã€‚ä¸ºä»€ä¹ˆè¦äº§ç”Ÿä¸€ä¸ªæ–°å¯¹è±¡è€Œä¸æ˜¯è¿”å›ä¸€ä¸ª Sink å­—æ®µï¼Ÿè¿™æ˜¯å› ä¸ºä½¿ç”¨ opWrapSink()å¯ä»¥å°†å½“å‰æ“ä½œä¸ä¸‹æ¸¸ Sinkï¼ˆä¸Šæ–‡ä¸­çš„ downstream å‚æ•°ï¼‰ç»“åˆæˆæ–° Sinkã€‚è¯•æƒ³åªè¦ä»æµæ°´çº¿çš„æœ€åä¸€ä¸ª Stage å¼€å§‹ï¼Œä¸æ–­è°ƒç”¨ä¸Šä¸€ä¸ª Stage çš„ opWrapSink()æ–¹æ³•ç›´åˆ°æœ€å¼€å§‹ï¼ˆä¸åŒ…æ‹¬ stage0ï¼Œå› ä¸º stage0 ä»£è¡¨æ•°æ®æºï¼Œä¸åŒ…å«æ“ä½œï¼‰ï¼Œå°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»£è¡¨äº†æµæ°´çº¿ä¸Šæ‰€æœ‰æ“ä½œçš„ Sinkï¼Œç”¨ä»£ç è¡¨ç¤ºå°±æ˜¯è¿™æ ·ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// AbstractPipeline.wrapSink()</span>
<span class="token comment">// ä»ä¸‹æ¸¸å‘ä¸Šæ¸¸ä¸æ–­åŒ…è£…Sinkã€‚å¦‚æœæœ€åˆä¼ å…¥çš„sinkä»£è¡¨ç»“æŸæ“ä½œï¼Œ</span>
<span class="token comment">// å‡½æ•°è¿”å›æ—¶å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªä»£è¡¨äº†æµæ°´çº¿ä¸Šæ‰€æœ‰æ“ä½œçš„Sinkã€‚</span>
<span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token function">wrapSink</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>E_OUT<span class="token punctuation">&gt;</span></span> sink<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">AbstractPipeline</span> p<span class="token operator">=</span><span class="token class-name">AbstractPipeline</span><span class="token punctuation">.</span><span class="token keyword">this</span><span class="token punctuation">;</span> p<span class="token punctuation">.</span>depth <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span> p<span class="token operator">=</span>p<span class="token punctuation">.</span>previousStage<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        sink <span class="token operator">=</span> p<span class="token punctuation">.</span><span class="token function">opWrapSink</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>previousStage<span class="token punctuation">.</span>combinedFlags<span class="token punctuation">,</span> sink<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> sink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨æµæ°´çº¿ä¸Šä»å¼€å§‹åˆ°ç»“æŸçš„æ‰€æœ‰çš„æ“ä½œéƒ½è¢«åŒ…è£…åˆ°äº†ä¸€ä¸ª Sink é‡Œï¼Œæ‰§è¡Œè¿™ä¸ª Sink å°±ç›¸å½“äºæ‰§è¡Œæ•´ä¸ªæµæ°´çº¿ï¼Œæ‰§è¡Œ Sink çš„ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// AbstractPipeline.copyInto(), å¯¹spliteratorä»£è¡¨çš„æ•°æ®æ‰§è¡ŒwrappedSinkä»£è¡¨çš„æ“ä½œã€‚</span>
<span class="token keyword">final</span> <span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> <span class="token keyword">void</span> <span class="token function">copyInto</span><span class="token punctuation">(</span><span class="token class-name">Sink</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> wrappedSink<span class="token punctuation">,</span> <span class="token class-name">Spliterator</span><span class="token generics"><span class="token punctuation">&lt;</span>P_IN<span class="token punctuation">&gt;</span></span> spliterator<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StreamOpFlag</span><span class="token punctuation">.</span><span class="token constant">SHORT_CIRCUIT</span><span class="token punctuation">.</span><span class="token function">isKnown</span><span class="token punctuation">(</span><span class="token function">getStreamAndOpFlags</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        wrappedSink<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span>spliterator<span class="token punctuation">.</span><span class="token function">getExactSizeIfKnown</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é€šçŸ¥å¼€å§‹éå†</span>
        spliterator<span class="token punctuation">.</span><span class="token function">forEachRemaining</span><span class="token punctuation">(</span>wrappedSink<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// è¿­ä»£</span>
        wrappedSink<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// é€šçŸ¥éå†ç»“æŸ</span>
    <span class="token punctuation">}</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ä»£ç é¦–å…ˆè°ƒç”¨ wrappedSink.begin()æ–¹æ³•å‘Šè¯‰ Sink æ•°æ®å³å°†åˆ°æ¥ï¼Œç„¶åè°ƒç”¨ spliterator.forEachRemaining()æ–¹æ³•å¯¹æ•°æ®è¿›è¡Œè¿­ä»£ï¼ˆSpliterator æ˜¯å®¹å™¨çš„ä¸€ç§è¿­ä»£å™¨ï¼Œå‚é˜…ï¼‰ï¼Œæœ€åè°ƒç”¨ wrappedSink.end()æ–¹æ³•é€šçŸ¥ Sink æ•°æ®å¤„ç†ç»“æŸã€‚é€»è¾‘å¦‚æ­¤æ¸…æ™°ã€‚</p><h4 id="æ‰§è¡Œåçš„ç»“æœåœ¨å“ªé‡Œ" tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œåçš„ç»“æœåœ¨å“ªé‡Œ" aria-hidden="true">#</a> æ‰§è¡Œåçš„ç»“æœåœ¨å“ªé‡Œï¼Ÿ</h4><p>æœ€åä¸€ä¸ªé—®é¢˜æ˜¯æµæ°´çº¿ä¸Šæ‰€æœ‰æ“ä½œéƒ½æ‰§è¡Œåï¼Œç”¨æˆ·æ‰€éœ€è¦çš„ç»“æœï¼ˆå¦‚æœæœ‰ï¼‰åœ¨å“ªé‡Œï¼Ÿé¦–å…ˆè¦è¯´æ˜çš„æ˜¯ä¸æ˜¯æ‰€æœ‰çš„ Stream ç»“æŸæ“ä½œéƒ½éœ€è¦è¿”å›ç»“æœï¼Œæœ‰äº›æ“ä½œåªæ˜¯ä¸ºäº†ä½¿ç”¨å…¶å‰¯ä½œç”¨(Side-effects)ï¼Œæ¯”å¦‚ä½¿ç”¨ Stream.forEach()æ–¹æ³•å°†ç»“æœæ‰“å°å‡ºæ¥å°±æ˜¯å¸¸è§çš„ä½¿ç”¨å‰¯ä½œç”¨çš„åœºæ™¯ï¼ˆäº‹å®ä¸Šï¼Œé™¤äº†æ‰“å°ä¹‹å¤–å…¶ä»–åœºæ™¯éƒ½åº”é¿å…ä½¿ç”¨å‰¯ä½œç”¨ï¼‰ï¼Œå¯¹äºçœŸæ­£éœ€è¦è¿”å›ç»“æœçš„ç»“æŸæ“ä½œç»“æœå­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</p><pre><code>ç‰¹åˆ«è¯´æ˜ï¼šå‰¯ä½œç”¨ä¸åº”è¯¥è¢«æ»¥ç”¨ï¼Œä¹Ÿè®¸ä½ ä¼šè§‰å¾—åœ¨Stream.forEach()é‡Œè¿›è¡Œå…ƒç´ æ”¶é›†æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå°±åƒä¸‹é¢ä»£ç ä¸­é‚£æ ·ï¼Œä½†é—æ†¾çš„æ˜¯è¿™æ ·ä½¿ç”¨çš„æ­£ç¡®æ€§å’Œæ•ˆç‡éƒ½æ— æ³•ä¿è¯ï¼Œå› ä¸ºStreamå¯èƒ½ä¼šå¹¶è¡Œæ‰§è¡Œã€‚å¤§å¤šæ•°ä½¿ç”¨å‰¯ä½œç”¨çš„åœ°æ–¹éƒ½å¯ä»¥ä½¿ç”¨å½’çº¦æ“ä½œæ›´å®‰å…¨å’Œæœ‰æ•ˆçš„å®Œæˆã€‚
</code></pre><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token comment">// é”™è¯¯çš„æ”¶é›†æ–¹å¼</span>
<span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> results <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
stream<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> results<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// Unnecessary use of side-effects!</span>
<span class="token comment">// æ­£ç¡®çš„æ”¶é›†æ–¹å¼</span>
<span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span>results <span class="token operator">=</span>
     stream<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>s <span class="token operator">-&gt;</span> pattern<span class="token punctuation">.</span><span class="token function">matcher</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
             <span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token class-name">Collectors</span><span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// No side-effects!</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å›åˆ°æµæ°´çº¿æ‰§è¡Œç»“æœçš„é—®é¢˜ä¸Šæ¥ï¼Œéœ€è¦è¿”å›ç»“æœçš„æµæ°´çº¿ç»“æœå­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿè¿™è¦åˆ†ä¸åŒçš„æƒ…å†µè®¨è®ºï¼Œä¸‹è¡¨ç»™å‡ºäº†å„ç§æœ‰è¿”å›ç»“æœçš„ Stream ç»“æŸæ“ä½œã€‚</p><p>è¿”å›ç±»å‹ å¯¹åº”çš„ç»“æŸæ“ä½œ boolean anyMatch() allMatch() noneMatch() Optional findFirst() findAny() å½’çº¦ç»“æœ reduce() collect() æ•°ç»„ toArray()</p><table width="350px"><tr><td align="center">è¿”å›ç±»å‹</td><td align="center">å¯¹åº”çš„ç»“æŸæ“ä½œ</td></tr><tr><td>boolean</td><td>anyMatch() allMatch() noneMatch()</td></tr><tr><td>Optional</td><td>findFirst() findAny()</td></tr><tr><td>å½’çº¦ç»“æœ</td><td>reduce() collect()</td></tr><tr><td>æ•°ç»„</td><td>toArray()</td></tr></table><ol><li>å¯¹äºè¡¨ä¸­è¿”å› boolean æˆ–è€… Optional çš„æ“ä½œï¼ˆOptional æ˜¯å­˜æ”¾ ä¸€ä¸ª å€¼çš„å®¹å™¨ï¼‰çš„æ“ä½œï¼Œç”±äºå€¼è¿”å›ä¸€ä¸ªå€¼ï¼Œåªéœ€è¦åœ¨å¯¹åº”çš„ Sink ä¸­è®°å½•è¿™ä¸ªå€¼ï¼Œç­‰åˆ°æ‰§è¡Œç»“æŸæ—¶è¿”å›å°±å¯ä»¥äº†ã€‚</li><li>å¯¹äºå½’çº¦æ“ä½œï¼Œæœ€ç»ˆç»“æœæ”¾åœ¨ç”¨æˆ·è°ƒç”¨æ—¶æŒ‡å®šçš„å®¹å™¨ä¸­ï¼ˆå®¹å™¨ç±»å‹é€šè¿‡æ”¶é›†å™¨æŒ‡å®šï¼‰ã€‚collect(), reduce(), max(), min()éƒ½æ˜¯å½’çº¦æ“ä½œï¼Œè™½ç„¶ max()å’Œ min()ä¹Ÿæ˜¯è¿”å›ä¸€ä¸ª Optionalï¼Œä½†äº‹å®ä¸Šåº•å±‚æ˜¯é€šè¿‡è°ƒç”¨ reduce()æ–¹æ³•å®ç°çš„ã€‚</li><li>å¯¹äºè¿”å›æ˜¯æ•°ç»„çš„æƒ…å†µï¼Œæ¯«æ— ç–‘é—®çš„ç»“æœä¼šæ”¾åœ¨æ•°ç»„å½“ä¸­ã€‚è¿™ä¹ˆè¯´å½“ç„¶æ˜¯å¯¹çš„ï¼Œä½†åœ¨æœ€ç»ˆè¿”å›æ•°ç»„ä¹‹å‰ï¼Œç»“æœå…¶å®æ˜¯å­˜å‚¨åœ¨ä¸€ç§å«åš Node çš„æ•°æ®ç»“æ„ä¸­çš„ã€‚Node æ˜¯ä¸€ç§å¤šå‰æ ‘ç»“æ„ï¼Œå…ƒç´ å­˜å‚¨åœ¨æ ‘çš„å¶å­å½“ä¸­ï¼Œå¹¶ä¸”ä¸€ä¸ªå¶å­èŠ‚ç‚¹å¯ä»¥å­˜æ”¾å¤šä¸ªå…ƒç´ ã€‚è¿™æ ·åšæ˜¯ä¸ºäº†å¹¶è¡Œæ‰§è¡Œæ–¹ä¾¿ã€‚å…³äº Node çš„å…·ä½“ç»“æ„ï¼Œæˆ‘ä»¬ä¼šåœ¨ä¸‹ä¸€èŠ‚æ¢ç©¶ Stream å¦‚ä½•å¹¶è¡Œæ‰§è¡Œæ—¶ç»™å‡ºè¯¦ç»†è¯´æ˜ã€‚</li></ol><h2 id="ç»“è¯­" tabindex="-1"><a class="header-anchor" href="#ç»“è¯­" aria-hidden="true">#</a> ç»“è¯­</h2><p>æœ¬æ–‡è¯¦ç»†ä»‹ç»äº† Stream æµæ°´çº¿çš„ç»„ç»‡æ–¹å¼å’Œæ‰§è¡Œè¿‡ç¨‹ï¼Œå­¦ä¹ æœ¬æ–‡å°†æœ‰åŠ©äºç†è§£åŸç†å¹¶å†™å‡ºæ­£ç¡®çš„ Stream ä»£ç ï¼ŒåŒæ—¶æ‰“æ¶ˆä½ å¯¹ Stream API æ•ˆç‡æ–¹é¢çš„é¡¾è™‘ã€‚å¦‚ä½ æ‰€è§ï¼ŒStream API å®ç°å¦‚æ­¤å·§å¦™ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨å¤–éƒ¨è¿­ä»£æ‰‹åŠ¨ç¼–å†™ç­‰ä»·ä»£ç ï¼Œä¹Ÿæœªå¿…æ›´åŠ é«˜æ•ˆã€‚</p><h2 id="å‚è€ƒé“¾æ¥" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥" aria-hidden="true">#</a> å‚è€ƒé“¾æ¥</h2><ul><li><a href="https://objcoding.com/2019/03/04/lambda" target="_blank" rel="noopener noreferrer">å…³äº Java Lambda è¡¨è¾¾å¼çœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº†<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li><li><a href="https://blog.csdn.net/asdfayw/article/details/53378179" target="_blank" rel="noopener noreferrer">Java8 ä¹‹ Stream/Map ä»¥åŠ Lambda<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></li></ul></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/docs/blogs/java/java8_lamnda_stream.md" rel="noopener noreferrer" target="_blank" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]--><!----><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">Last update: </span><!----></div><div class="meta-item contributors"><span class="label">Contributors: </span><!--[--><!--[--><span class="contributor" title="email: 1127280933@qq.com">ClearLove443</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><!----><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/v2/assets/app-8407fbc1.js" defer></script>
  </body>
</html>
