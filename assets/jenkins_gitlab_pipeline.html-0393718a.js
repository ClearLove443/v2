import{_ as n,V as t,W as a,a0 as s}from"./framework-7c77a285.js";const o="/v2/1_zxRWg_D0NSuRYD38rX64AA.png",r="/v2/1_RGqRiQAh0oldwqAErdhASw.png",l="/v2/1_B_2gzjgzVCdWZhCtHEK6-Q.png",c="/v2/1_ZRTdQCBRsiXHW1sB8WZM5Q.png",d="/v2/1_Cau3JzuTX5cKYSlwmg41QA.png",p="/v2/1_h6iPjC-4b7Kbk30csafyeA.png",u="/v2/1_aq0KlMJPnYDkPMCz_Ul-1w.png",g="/v2/1_DmXrE5yjMZZRnoMuEsdwNQ.png",h="/v2/1_q3H7M4GTq7Cz8uA4wvohfg.jpeg",f="/v2/1_5wBEBvOFM8umC9uuhgP-Cw.png",m="/v2/1_3G72OilRB69NSCQwPEb6jw.png",b="/v2/1_fTE2XG_QkAMoIxGwL-9J0Q.png",k="/v2/1_SGIwwmgJF7ZadvlRXGO1mA.png",v="/v2/1_c7fZWOIzruYaFXUT9ZHWzg.png",y="/v2/1_DOCwZJYBHhA9XvGlfcQEEA.png",J="/v2/1_xHMNSRGy0l8MV6B2P2nckQ.png",w="/v2/1_4WshKFBNdq80y_LiyDR3Sw.png",_="/v2/1_P7PEcXWUKYuDBydgsaiESg.png",P="/v2/1_p8d96s1Qo2PQpeI0QKXOPA.png",x="/v2/1_X7BK7kbAEh1Mncne14DOVw.png",G="/v2/1_T2h9N3QMq5vaUraeIzeb4w.png",L="/v2/1_Omr8diPglypKPE07GUjkwQ.png",C="/v2/1_lqHfBc-DN4_Jl0b7Gw-reA.png",A="/v2/1_7Y1uLCVr-dX6TyzHlJTuXw.png",i="/v2/1_d6_i2skZkr7y-CWZYE7PHw.png",M="/v2/1_V3nwYMmky_tN7yg-42x5yQ.png",j="/v2/1_cbi7Auiu-Ni4L15NHuIRBA.png",S={};function z(I,e){return t(),a("div",null,e[0]||(e[0]=[s('<p>This post will show you how to configure a Jenkins pipeline that will automatically build your project when you push code to a GitLab repository. We will be using a Jenkinsfile to define our pipeline, which is best practice. Here’s the workflow: Push to GitLab → Jenkins pipeline triggered → Run build (Maven) → Run JUnit tests (Maven) → Email result from pipeline If you don’t already have GitLab and Jenkins installed, you can follow the instructions in this post and then come back here. This post also assumes you have Java, Git, and Maven installed, along with a simple Maven project with at least one JUnit test. Make sure you’re able to successfully run mvn clean install and mvn test on your project before following along.</p><figure><img src="'+o+'" alt="Jenkins Pipe1" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe1</figcaption></figure><h1 id="step-1-create-a-gitlab-repository" tabindex="-1"><a class="header-anchor" href="#step-1-create-a-gitlab-repository" aria-hidden="true">#</a> Step 1: Create a GitLab Repository</h1><p>In GitLab, create a group by clicking on the Groups dropdown and then clicking the New group button. Give your group a name and then click Create group.</p><figure><img src="'+r+'" alt="Jenkins Pipe2" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe2</figcaption></figure><p>Create a new project by clicking New project. Give it a name and click Create project.</p><figure><img src="'+l+`" alt="Jenkins Pipe3" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe3</figcaption></figure><p>Initialize your local Maven project and push it to your new repository:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token builtin class-name">cd</span> existing_folder
<span class="token function">git</span> init
<span class="token function">git</span> remote <span class="token function">add</span> origin http://localhost/my-group/my-project.git
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;Initial commit&quot;</span>
<span class="token function">git</span> push <span class="token parameter variable">-u</span> origin master
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Refresh your project in GitLab and you should see your code. If you see a banner saying “The Auto DevOps pipeline has been enabled…” go into settings and disable it.</p><h1 id="step-2-create-a-jenkins-user-in-gitlab" tabindex="-1"><a class="header-anchor" href="#step-2-create-a-jenkins-user-in-gitlab" aria-hidden="true">#</a> Step 2: Create a Jenkins User in GitLab</h1><p>We need to create a Jenkins user in GitLab so that Jenkins can communicate with GitLab’s API via the plugin we will install in Step 4. In GitLab, go to the Admin Area by clicking on the wrench icon in the top toolbar.</p><p>In the left menu, click on Users and then click New user at the top right hand corner. Fill out the required fields appropriately and make sure to select the Admin radio button under Access level:</p><figure><img src="`+c+'" alt="Jenkins Pipe4" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe4</figcaption></figure><p>Go back to the Users page and edit the Jenkins user you just created. Give the user a password so that you can log in as that user. Once you’ve done this, log out of your current session and log in as the Jenkins user. Once logged in as the Jenkins user, go to your settings and click Access Tokens in the left menu bar. Make sure to give your token a name and select api under Scopes.</p><figure><img src="'+d+'" alt="Jenkins Pipe5" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe5</figcaption></figure><p>Once you have created the access token, copy and paste the token somewhere temporarily — you will not be able to access it from here again. We will use this token later. Log out and log back in as the root user.</p><h1 id="step-3-create-a-gitlab-user-in-jenkins" tabindex="-1"><a class="header-anchor" href="#step-3-create-a-gitlab-user-in-jenkins" aria-hidden="true">#</a> Step 3: Create a GitLab User in Jenkins</h1><p>Now, we need to create a GitLab user in Jenkins so that GitLab can notify Jenkins of updates to the repository via webhooks. From the Jenkins homepage, go to Manage Jenkins → Manage Users → Create User and fill in the form.</p><figure><img src="'+p+'" alt="Jenkins Pipe6" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe6</figcaption></figure><p>After creating the user, log out and log back in as the “gitlab” user. Go to Manage Jenkins → Manage Users and click on the gear icon next to the gitlab user to configure it. Under API Token, click Add new Token and give it a name, then click Generate.</p><figure><img src="'+u+'" alt="Jenkins Pipe7" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe7</figcaption></figure><p>Once you have generated the token, copy and paste the token somewhere temporarily — you will not be able to access it from here again. We will use this token later. Log out and log back in as the admin user.</p><h1 id="step-4-install-and-configure-gitlab-plugin-for-jenkins" tabindex="-1"><a class="header-anchor" href="#step-4-install-and-configure-gitlab-plugin-for-jenkins" aria-hidden="true">#</a> Step 4: Install and Configure GitLab Plugin for Jenkins</h1><p>We need to install the GitLab plugin for Jenkins so that they can communicate with each other. On the Jenkins homepage, click on Manage Jenkins → Manage Plugins. Click on the Available tab and search for “gitlab” and install the GitLab plugin.</p><figure><img src="'+g+'" alt="Jenkins Pipe8" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe8</figcaption></figure><p>Check the box for “Restart Jenkins when installation is complete…” If you miss this, you can also restart Jenkins with sudo <code>systemctl restart jenkins</code> after the download has finished.</p><figure><img src="'+h+'" alt="Jenkins Pipe9" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe9</figcaption></figure><p>After about a minute, refresh the page and log back in as the admin user again. In Jenkins, go to Manage Jenkins → Configure System and scroll down to the Gitlab section. Enter in a name for the connection, the URL to your GitLab instance, and then next to Credentials, click Add → Jenkins. This is where you will add your GitLab token from Step 2.</p><figure><img src="'+f+'" alt="Jenkins Pipe10" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe10</figcaption></figure><p>Next to Kind, select GitLab API Token. Paste your GitLab API token and give it an ID and a description, and click Add to add the token to Jenkins:</p><figure><img src="'+m+'" alt="Jenkins Pipe11" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe11</figcaption></figure><p>Click the dropdown next to Credentials and select the token. Then click Test Connection — you should see “Success” afterward:</p><figure><img src="'+b+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Click Save at the bottom of the screen to save your changes. You can view your newly created credential at Manage Jenkins → Credentials. Now Jenkins is ready to communicate with the GitLab API.</p><h1 id="step-5-create-a-jenkins-pipeline" tabindex="-1"><a class="header-anchor" href="#step-5-create-a-jenkins-pipeline" aria-hidden="true">#</a> Step 5: Create a Jenkins Pipeline</h1><p>On the Jenkins homepage, click New Item in the left menu bar. Enter the name for the item and select Pipeline. Click OK to create it:</p><figure><img src="'+k+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>The next thing you will see is the pipeline configuration page. Check the box for Discard old builds and set Max # of builds to keep to a reasonable number (I chose 3 for this tutorial):</p><figure><img src="'+v+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Ensure that the connection you created in Step 4 is selected next to GitLab Connection:</p><figure><img src="'+y+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Under the Build Triggers section, check the box for Build when a change is pushed to GitLab and copy the GitLab webhook URL next to it for later. Leave the Enabled GitLab triggers section unchanged:</p><figure><img src="'+J+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Under the Pipeline section, select Pipeline script from SCM from the Definition dropdown (this will be the Jenkinsfile described later) and select Git from the SCM dropdown. Enter the repository URL (same as what you use for git clone). You should see an authentication error because we haven’t provided a username/password that can access your GitLab repository yet:</p><figure><img src="'+w+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Next to Credentials, click Add → Jenkins and fill in your GitLab username/password and click Add:</p><figure><img src="'+_+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Select your credential from the Credentials dropdown and the authentication error should go away. If it doesn’t, ensure you have the right username/password and that the user has access rights to the repository.</p><figure><img src="'+P+`" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Click Save at the bottom of the screen.</p><h1 id="step-6-configure-a-webhook-in-gitlab" tabindex="-1"><a class="header-anchor" href="#step-6-configure-a-webhook-in-gitlab" aria-hidden="true">#</a> Step 6: Configure a Webhook in GitLab</h1><p>We need a way for GitLab to tell Jenkins when code has been pushed to a repository — this is what webhooks are for. NOTE: If your Jenkins instance is running on localhost, follow these steps to allow GitLab to send requests locally: Go to the Admin Area Hover over Settings and click Network Expand Outbound requests Check the box for Allow requests to the local network from web hooks and services Click Save changes In GitLab, go to your project and then hover over Settings at the bottom of the left menu bar, then click on Webhooks. Enter in the URL to your Jenkins pipeline (the one you copied from the last step) and modify it so that it follows this scheme:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>http://&lt;gitlab-user-in-jenkins&gt;:&lt;token&gt;@&lt;host&gt;/project/&lt;project-name&gt;
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Leave the Secret Token field blank and ensure that Push events is checked.</p><figure><img src="`+x+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Click Add webhook and then scroll down to the bottom to see your webhook. Test it by clicking Test → Push events. You should see a 200 status code:</p><p>If you go back to Jenkins, you should see a failed build — this is good news because it means that the webhook worked, and that Jenkins is able to listen for pushes to your GitLab repository. If you inspect the Jenkins build console output, you will see something similar to this error:</p><figure><img src="'+G+`" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><h1 id="step-7-add-a-jenkinsfile" tabindex="-1"><a class="header-anchor" href="#step-7-add-a-jenkinsfile" aria-hidden="true">#</a> Step 7: Add a Jenkinsfile</h1><p>Inside your git repository, create a file named “Jenkinsfile” at the root level. Paste the following into your Jenkinsfile and push it to your repository:</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
    agent any

    stages {
        stage(&#39;Build&#39;) {
            steps {
                sh &#39;mvn clean install -DskipTests&#39;
            }
        }
        stage(&#39;Test&#39;) {
            steps {
                sh &#39;mvn test&#39;
            }
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>This Jenkinsfile is telling Jenkins to split the build up into stages — first a “Build” stage that builds our Maven project and then a “Test” stage that runs our JUnit tests through Maven. Assuming you have Maven installed and configured on the same machine that Jenkins is running on, you should see something like the following when you view your pipeline project in Jenkins:</p><figure><img src="`+L+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>If you see a red rectangle instead of a green one in the Build or Test stages, it means that either your code failed to build or one of your unit tests failed. You can inspect the entire process by clicking on the build in the Build History section and then clicking on Console Output.</p><figure><img src="'+C+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><h1 id="step-8-email-notifications" tabindex="-1"><a class="header-anchor" href="#step-8-email-notifications" aria-hidden="true">#</a> Step 8: Email Notifications</h1><p>It is common practice to have the pipeline send an email to the user who pushed their code to let them know whether their build passed or failed. If you don’t already have “Email Extension Plugin” installed, install that plugin before continuing. NOTE: Make sure the GitLab account you are pushing from has a valid email address — this is the address your pipeline will send an email to. Configure the plugin by going to Manage Jenkins → Configure System and scrolling down to Extended E-mail Notification. Fill in your SMTP server, click Advanced… and check the box for Use SMTP Authentication. Fill in your username (email address) and password, then check the box for Use SSL. Enter 465 for the SMTP port:</p><figure><img src="'+A+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Scroll back up to the top, and under Jenkins Location, change the System Admin e-mail address to “Jenkins <a href="mailto:jenkins@jenkins">jenkins@jenkins</a>” — this will appear as the sender name in the email you will receive.</p><figure><img src="'+i+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Click Save at the bottom. In your Jenkinsfile, add the following “post” section after the “stages” section and push it to your repository.</p><figure><img src="'+i+`" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>pipeline {
    agent any

    stages {
        stage(&#39;Build&#39;) {
            steps {
                sh &#39;mvn clean install -DskipTests&#39;
            }
        }
        stage(&#39;Test&#39;) {
            steps {
                sh &#39;mvn test&#39;
            }
        }
    }

    post {
        always {
            emailext subject: &quot;Jenkins Build \${currentBuild.currentResult}: Job \\&quot;\${env.JOB_NAME}\\&quot;&quot;,
                body: &quot;\${currentBuild.currentResult}: Job \\&quot;\${env.JOB_NAME}\\&quot; build \${env.BUILD_NUMBER}.\\nMore info at: \${env.BUILD_URL}&quot;,
                recipientProviders: [[$class: &#39;DevelopersRecipientProvider&#39;], [$class: &#39;RequesterRecipientProvider&#39;]]
        }
    }
}
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here, we’re telling Jenkins to always send an email to the user after the build completes, and giving it a template for how to display the information. Go back to your Jenkins pipeline to see it running. If all went well, you should see something similar to the following and should have also received an email.</p><figure><img src="`+M+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><figure><img src="'+j+'" alt="Jenkins Pipe12" tabindex="0" loading="lazy"><figcaption>Jenkins Pipe12</figcaption></figure><p>Congratulations! You have successfully set up a Jenkins pipeline to automatically build Java projects from GitLab.</p>',78)]))}const E=n(S,[["render",z],["__file","jenkins_gitlab_pipeline.html.vue"]]);export{E as default};
