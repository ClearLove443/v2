import{_ as a,V as e,W as s,a0 as n}from"./framework-b293865d.js";const r={},i=n(`<p>在 0.9.0.0 之后的 Kafka，出现了几个新变动，一个是在 Server 端增加了 GroupCoordinator 这个角色，另一个较大的变动是将 topic 的 offset 信息由之前存储在 zookeeper 上改为存储到一个特殊的 <code>topic（__consumer_offsets)</code>中(即 broker 中)。 下面的命令 参数<code>(--zookeeper localhost:2181)</code> 替换为<code>(--bootstrap-server brokerhost)</code></p><p>本文测试版本：kafka_2.11-2.2.0</p><h2 id="启动-kafka" tabindex="-1"><a class="header-anchor" href="#启动-kafka" aria-hidden="true">#</a> 启动 Kafka</h2><p>后台常驻方式，带上参数 <code>-daemon</code>，如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-server-start.sh <span class="token parameter variable">-daemon</span> /usr/local/kafka/config/server.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>指定 JMX port 端口启动，指定 jmx，可以方便监控 Kafka 集群</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token assign-left variable">JMX_PORT</span><span class="token operator">=</span><span class="token number">9991</span> /usr/local/kafka/bin/kafka-server-start.sh <span class="token parameter variable">-daemon</span> /usr/local/kafka/config/server.properties
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="停止-kafka" tabindex="-1"><a class="header-anchor" href="#停止-kafka" aria-hidden="true">#</a> 停止 Kafka</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-server-stop.sh
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="topic" tabindex="-1"><a class="header-anchor" href="#topic" aria-hidden="true">#</a> Topic</h2><h3 id="创建-topic" tabindex="-1"><a class="header-anchor" href="#创建-topic" aria-hidden="true">#</a> 创建 Topic</h3><p>参数 <code>--topic</code> 指定 Topic 名，<code>--partitions</code> 指定分区数，<code>--replication-factor</code> 指定备份数：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> localhost:2181 --replication-factor <span class="token number">1</span> <span class="token parameter variable">--partitions</span> <span class="token number">1</span> <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意，如果配置文件 server.properties 指定了 Kafka 在 zookeeper 上的目录，则参数也要指定，否则会报无可用的 brokers（下面部分命令也有同样的情况），如：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--create</span> <span class="token parameter variable">--zookeeper</span> localhost:2181/kafka --replication-factor <span class="token number">1</span> <span class="token parameter variable">--partitions</span> <span class="token number">1</span> <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="列出所有-topic" tabindex="-1"><a class="header-anchor" href="#列出所有-topic" aria-hidden="true">#</a> 列出所有 Topic</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--list</span> <span class="token parameter variable">--zookeeper</span> localhost:2181
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看-topic" tabindex="-1"><a class="header-anchor" href="#查看-topic" aria-hidden="true">#</a> 查看 Topic</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--describe</span> <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="增加-topic-的-partition-数" tabindex="-1"><a class="header-anchor" href="#增加-topic-的-partition-数" aria-hidden="true">#</a> 增加 Topic 的 partition 数</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--alter</span> <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--partitions</span> <span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看-topic-指定分区-offset-的最大值或最小值" tabindex="-1"><a class="header-anchor" href="#查看-topic-指定分区-offset-的最大值或最小值" aria-hidden="true">#</a> 查看 topic 指定分区 offset 的最大值或最小值</h3><p>time 为 -1 时表示最大值，为 -2 时表示最小值：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-run-class.sh kafka.tools.GetOffsetShell <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--time</span> <span class="token parameter variable">-1</span> --broker-list <span class="token number">127.0</span>.0.1:9092 <span class="token parameter variable">--partitions</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="删除-topic" tabindex="-1"><a class="header-anchor" href="#删除-topic" aria-hidden="true">#</a> 删除 Topic</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-topics.sh <span class="token parameter variable">--zookeeper</span> localhost:2181 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--delete</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="生产消息" tabindex="-1"><a class="header-anchor" href="#生产消息" aria-hidden="true">#</a> 生产消息</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-producer.sh --broker-list localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="消费消息" tabindex="-1"><a class="header-anchor" href="#消费消息" aria-hidden="true">#</a> 消费消息</h2><h3 id="从头开始" tabindex="-1"><a class="header-anchor" href="#从头开始" aria-hidden="true">#</a> 从头开始</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> --from-beginning
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="从尾部开始" tabindex="-1"><a class="header-anchor" href="#从尾部开始" aria-hidden="true">#</a> 从尾部开始</h3><p>从尾部开始取数据，必需要指定分区：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--offset</span> latest <span class="token parameter variable">--partition</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="指定分区" tabindex="-1"><a class="header-anchor" href="#指定分区" aria-hidden="true">#</a> 指定分区</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--offset</span> latest <span class="token parameter variable">--partition</span> <span class="token number">0</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="取指定个数" tabindex="-1"><a class="header-anchor" href="#取指定个数" aria-hidden="true">#</a> 取指定个数</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--offset</span> latest <span class="token parameter variable">--partition</span> <span class="token number">0</span> --max-messages <span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="消费者-group" tabindex="-1"><a class="header-anchor" href="#消费者-group" aria-hidden="true">#</a> 消费者 Group</h2><h3 id="指定-group" tabindex="-1"><a class="header-anchor" href="#指定-group" aria-hidden="true">#</a> 指定 Group</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">-group</span> test_group --from-beginning
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="消费者-group-列表" tabindex="-1"><a class="header-anchor" href="#消费者-group-列表" aria-hidden="true">#</a> 消费者 Group 列表</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--list</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="查看-group-详情" tabindex="-1"><a class="header-anchor" href="#查看-group-详情" aria-hidden="true">#</a> 查看 Group 详情</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--group</span> test_group <span class="token parameter variable">--describe</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>输出：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Consumer group <span class="token string">&#39;test_group&#39;</span> has no active members.

TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
<span class="token builtin class-name">test</span>            <span class="token number">0</span>          <span class="token number">5</span>               <span class="token number">5</span>               <span class="token number">0</span>               -               -               -

<span class="token comment"># CURRENT-OFFSET: 当前消费者群组最近提交的 offset，也就是消费者分区里读取的当前位置</span>
<span class="token comment"># LOG-END-OFFSET: 当前最高水位偏移量，也就是最近一个读取消息的偏移量，同时也是最近一个提交到集群的偏移量</span>
<span class="token comment"># LAG：消费者的 CURRENT-OFFSET 与 broker 的 LOG-END-OFFSET 之间的差距</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="删除-group-中-topic" tabindex="-1"><a class="header-anchor" href="#删除-group-中-topic" aria-hidden="true">#</a> 删除 Group 中 Topic</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--group</span> test_group <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> <span class="token parameter variable">--delete</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="删除-group" tabindex="-1"><a class="header-anchor" href="#删除-group" aria-hidden="true">#</a> 删除 Group</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-consumer-groups.sh --bootstrap-server localhost:9092 <span class="token parameter variable">--group</span> test_group <span class="token parameter variable">--delete</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="平衡-leader" tabindex="-1"><a class="header-anchor" href="#平衡-leader" aria-hidden="true">#</a> 平衡 leader</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-preferred-replica-election.sh --bootstrap-server localhost:9092
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="自带压测工具" tabindex="-1"><a class="header-anchor" href="#自带压测工具" aria-hidden="true">#</a> 自带压测工具</h2><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>/usr/local/kafka/bin/kafka-producer-perf-test.sh <span class="token parameter variable">--topic</span> <span class="token builtin class-name">test</span> --num-records <span class="token number">100</span> --record-size <span class="token number">1</span> <span class="token parameter variable">--throughput</span> <span class="token number">100</span> --producer-props <span class="token assign-left variable">bootstrap.servers</span><span class="token operator">=</span>localhost:9092
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,55),l=[i];function t(o,c){return e(),s("div",null,l)}const p=a(r,[["render",t],["__file","kafka-common-commands.html.vue"]]);export{p as default};
